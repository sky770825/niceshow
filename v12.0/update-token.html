<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>更新 GitHub Token</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', sans-serif;
            max-width: 500px;
            margin: 50px auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border: 1px solid #a7f3d0;
        }
        .btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #059669;
        }
        .token-info {
            background: #f3f4f6;
            padding: 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
            margin: 1rem 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔑 GitHub Token 更新</h1>
        
        <div class="success">
            ✅ 您的 Token 驗證成功！<br>
            使用者: sky770825<br>
            權限: repo (完整倉庫存取權限)
        </div>
        
        <p>正在設定您的 GitHub Token...</p>
        
        <div class="token-info" id="tokenInfo">
            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
        </div>
        
        <div id="status"></div>
        
        <div>
            <a href="admin.html" class="btn">🏠 回到管理後台</a>
            <button class="btn" onclick="testSync()">🧪 測試同步功能</button>
        </div>
        
        <div id="testResult"></div>
    </div>

    <script>
        // 新的有效 Token
        const newToken = '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';
        
        // 設定 Token
        function setToken() {
            try {
                localStorage.setItem('githubToken', newToken);
                document.getElementById('status').innerHTML = '<div class="success">✅ Token 已成功儲存到系統中！</div>';
                return true;
            } catch (error) {
                document.getElementById('status').innerHTML = `<div style="background:#fee2e2;color:#991b1b;padding:1rem;border-radius:6px;margin:1rem 0;">❌ 儲存失敗: ${error.message}</div>`;
                return false;
            }
        }
        
        // 測試同步功能
        async function testSync() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="background:#dbeafe;color:#1e40af;padding:1rem;border-radius:6px;margin:1rem 0;">🔄 正在測試同步功能...</div>';
            
            try {
                // 測試 GitHub API 連線
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${newToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    resultDiv.innerHTML = `<div class="success">✅ 同步功能測試成功！<br>使用者: ${user.login}<br>現在可以使用「儲存並同步」功能了</div>`;
                } else {
                    resultDiv.innerHTML = `<div style="background:#fee2e2;color:#991b1b;padding:1rem;border-radius:6px;margin:1rem 0;">❌ 測試失敗: ${response.status} ${response.statusText}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="background:#fee2e2;color:#991b1b;padding:1rem;border-radius:6px;margin:1rem 0;">❌ 測試失敗: ${error.message}</div>`;
            }
        }
        
        // 頁面載入時自動設定 Token
        document.addEventListener('DOMContentLoaded', function() {
            setToken();
        });
    </script>
</body>
</html>
