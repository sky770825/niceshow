# 📊 Google Sheets 週次控制完整指南

## ✅ 已完成的設定

你的系統現在**完全由 Google Sheets 控制週次資料**！

### 已移除的內容：
- ❌ HTML 中硬編碼的所有週次資料（原本 201-844 行）
- ❌ 硬編碼的週次標籤

### 現在的運作方式：
- ✅ 週次資料完全從 Google Sheets 讀取
- ✅ 自動按日期分組成週次
- ✅ 自動過濾過期週次
- ✅ 自動選擇當前週次

---

## 🔧 Google Sheets 設定要求

### 1. 試算表設定

**你的 Google Sheets ID：** `1oS9zTU6DL_cCRnOI6A4ffAeXXn7fXkr6URxxMVprlG4`

**必須設為公開：**
1. 打開你的 Google Sheets
2. 點擊右上角「共用」按鈕
3. 選擇「知道連結的任何人」
4. 設為「檢視者」權限

### 2. 試算表欄位格式

你的 Google Sheets **必須包含以下欄位**（欄位順序很重要）：

| A | B | C | D | E | F | G | H | I |
|---|---|---|---|---|---|---|---|---|
| 時間戳記 | 您的店名 | 餐車類型 | 預約場地 | 預約日期 | 己排 | 費用 | 已付 | 備註 |

#### 重要欄位說明：

**B. 您的店名** (必填)
- 餐車的名稱，會顯示在行程表上
- 例如：`饞了找我`、`宇宙雞蛋糕`

**D. 預約場地** (必填)
- 必須包含四維路地址
- 支援的地址：
  - `四維路59號`
  - `四維路60號`
  - `四維路70號`
  - `四維路72號`
  - `四維路77號`
  - `四維路190號`
  - `四維路216號`
  - `四維路218號`
- 例如：`漢堡大亨 四維路70號(週一~週六)`
- 系統會自動從中提取地址

**E. 預約日期** (必填，格式嚴格)
- 格式：`X月X日(星期X)` 或 `X月X日（星期X）`
- ✅ 正確範例：
  - `10月21日(星期一)`
  - `10月21日（星期一）`
  - `9月5日(星期二)`
- ❌ 錯誤範例：
  - `10/21` （缺少月日字和星期）
  - `10月21日 星期一` （缺少括號）
  - `10月21日(週一)` （應該是「星期一」不是「週一」）

**F. 己排** (必填，用於控制是否顯示)
- 必須填寫：`己排班`（完全一致，包含「班」字）
- ⚠️ 只有填寫 `己排班` 的餐車才會顯示在行程表上
- 其他值（如空白、`待排`、`己排`）都不會顯示

---

## 📝 使用範例

### 正確的 Google Sheets 資料範例：

| 時間戳記 | 您的店名 | 餐車類型 | 預約場地 | 預約日期 | 己排 | 費用 | 已付 | 備註 |
|---------|---------|---------|---------|---------|------|------|------|------|
| 2024/10/14 12:00:00 | 饞了找我 | 美食餐車 | 漢堡大亨 四維路70號(週一~週六) | 10月21日(星期一) | 己排班 | 500 | 是 | |
| 2024/10/14 12:05:00 | 宇宙雞蛋糕 | 甜點餐車 | 漢堡大亨後方 四維路60號(週一~週六) | 10月21日(星期一) | 己排班 | 500 | 是 | |
| 2024/10/14 13:00:00 | 台東放山豬石板烤肉 | 燒烤餐車 | 台東放山豬_楊梅_四維路216號 | 10月22日(星期二) | 己排班 | 800 | 是 | |
| 2024/10/14 14:00:00 | 安德尼斯烘焙坊 | 烘焙餐車 | 漢堡大亨 四維路70號(週一~週六) | 10月23日(星期三) | 待排 | 500 | 否 | 尚未確認 |

### 顯示結果：

**10月21日（週一）** 會顯示：
- 饞了找我 （四維路70號）
- 宇宙雞蛋糕 （四維路60號）

**10月22日（週二）** 會顯示：
- 台東放山豬石板烤肉 （四維路216號）

**10月23日（週三）** 會顯示：
- （無餐車，因為安德尼斯烘焙坊的「己排」欄位是「待排」不是「己排班」）

---

## 🔍 測試與除錯

### 步驟 1: 測試 Google Sheets 連接

1. 在瀏覽器開啟：`http://localhost:3000/test-sheets.html`
2. 點擊「測試 Google Sheets 連接」按鈕
3. 確認顯示「✅ 連接成功」
4. 查看讀取到的資料筆數

### 步驟 2: 檢查原始資料

1. 點擊「顯示原始資料」按鈕
2. 檢查所有欄位是否正確：
   - 店名是否正確
   - 預約場地是否包含地址
   - 預約日期格式是否符合要求
   - 「己排」欄位是否填寫「己排班」

### 步驟 3: 檢查轉換後資料

1. 點擊「顯示轉換後資料」按鈕
2. 檢查：
   - 日期是否正確分組
   - 餐車數量是否正確
   - 只有「己排班」的餐車被顯示

### 步驟 4: 查看正式頁面

1. 在瀏覽器開啟：`http://localhost:3000/index.html`
2. 查看是否正確載入週次
3. 點擊餐車名稱測試導航功能

---

## 🐛 常見問題排解

### 問題 1: 顯示「連接失敗」

**可能原因：**
- Google Sheets 未設為公開
- Sheet ID 或 GID 錯誤
- 網路連線問題

**解決方法：**
1. 確認 Google Sheets 設為「知道連結的任何人」可檢視
2. 檢查 `sheets-booking.js` 中的 SHEET_ID 和 SHEET_GID 是否正確
3. 嘗試清除瀏覽器快取

### 問題 2: 某些餐車沒有顯示

**可能原因：**
- 「己排」欄位沒有填寫「己排班」
- 日期格式不正確
- 地址格式不正確

**解決方法：**
1. 檢查「己排」欄位是否填寫「己排班」（注意有「班」字）
2. 確認日期格式：`10月21日(星期一)`
3. 確認地址包含支援的四維路地址

### 問題 3: 日期顯示錯誤

**可能原因：**
- 預約日期格式不符合要求
- 星期填寫錯誤

**解決方法：**
1. 使用正確格式：`10月21日(星期一)`
2. 星期要用「星期一」不是「週一」
3. 括號可以是 `()` 或 `（）`

### 問題 4: 週次過濾不正確

**系統規則：**
- 自動過濾已過期的週次
- 保留當前週次和未來 3 週
- 最多顯示 4 週

**如果需要顯示更多週次：**
修改 `sheets-booking.js` 第 418 行：
```javascript
const maxWeeks = 4; // 改成你想要的週數，例如 6
```

---

## ⚙️ 進階設定

### 修改 Google Sheets ID

如果要更換到不同的 Google Sheets，編輯 `sheets-booking.js`：

```javascript
const BOOKING_SHEETS_CONFIG = {
    SHEET_ID: '你的新SHEET_ID',  // 從 Google Sheets URL 中取得
    SHEET_GID: '你的新SHEET_GID', // 從工作表 URL 中取得
    ENABLED: true,
    // ...
};
```

### 取得 Sheet ID 和 GID

從你的 Google Sheets URL：
```
https://docs.google.com/spreadsheets/d/1oS9zTU6DL_cCRnOI6A4ffAeXXn7fXkr6URxxMVprlG4/edit#gid=782323585
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^          ^^^^^^^^^^^
                                                    SHEET_ID                                  GID
```

### 新增支援的地址

如果要新增其他地址，編輯 `sheets-booking.js`：

```javascript
addressMap: {
    '四維路70號': '四維路70號',
    '四維路60號': '四維路60號',
    '四維路59號': '四維路59號',
    '四維路999號': '四維路999號',  // 新增地址
    // ...
}
```

同時也要在 `script.js` 中新增對應的 Google Maps 連結：

```javascript
const addressMap = {
    '四維路59號': 'https://maps.app.goo.gl/jaKQjQ6jArFZda898',
    '四維路60號': 'https://maps.app.goo.gl/rxGpsi2UpsTEEV5w5',
    '四維路70號': 'https://maps.app.goo.gl/k3rPvM6UwQJqwC5k7',
    '四維路999號': 'https://maps.app.goo.gl/你的GoogleMaps連結',  // 新增
    // ...
};
```

### 停用 Google Sheets（改回使用本地資料）

如果想暫時停用 Google Sheets，編輯 `sheets-booking.js`：

```javascript
const BOOKING_SHEETS_CONFIG = {
    // ...
    ENABLED: false,  // 改為 false
    // ...
};
```

---

## 📊 系統運作流程

```
1. 使用者開啟網頁
   ↓
2. script.js 初始化
   ↓
3. 檢查 sheets-booking.js 是否啟用
   ↓
4. 從 Google Sheets 讀取 CSV 資料
   ↓
5. 解析 CSV 資料
   ↓
6. 過濾「己排班」的餐車
   ↓
7. 按日期分組
   ↓
8. 按週次分組（每 7 天）
   ↓
9. 過濾過期週次
   ↓
10. 渲染週次標籤和內容
   ↓
11. 自動選擇當前週次
```

---

## 🎯 快速檢查清單

使用這個清單確保一切設定正確：

- [ ] Google Sheets 已設為「知道連結的任何人」可檢視
- [ ] SHEET_ID 和 SHEET_GID 設定正確
- [ ] Google Sheets 包含所有必要欄位（時間戳記、您的店名、餐車類型、預約場地、預約日期、己排）
- [ ] 「預約日期」格式正確：`10月21日(星期一)`
- [ ] 「己排」欄位填寫「己排班」（包含「班」字）
- [ ] 「預約場地」包含支援的四維路地址
- [ ] `sheets-booking.js` 的 ENABLED 設為 `true`
- [ ] 測試頁面 `test-sheets.html` 顯示連接成功
- [ ] 正式頁面 `index.html` 正確顯示週次
- [ ] 點擊餐車名稱可以開啟 Google Maps 導航

---

## 📞 需要協助？

如果遇到問題：

1. 先使用 `test-sheets.html` 測試連接
2. 檢查瀏覽器的 Console（按 F12 → Console）查看錯誤訊息
3. 確認 Google Sheets 格式完全符合要求
4. 參考本文檔的「常見問題排解」章節

---

## 🎉 完成！

現在你的餐車月行程表完全由 Google Sheets 控制！

**優點：**
- ✅ 不需要修改程式碼就能更新行程
- ✅ 在 Google Sheets 中填寫資料即可
- ✅ 自動過濾過期週次
- ✅ 自動選擇當前週次
- ✅ 支援多人協作編輯 Google Sheets

**使用流程：**
1. 在 Google Sheets 中新增或修改餐車資料
2. 確保「己排」欄位填寫「己排班」
3. 重新整理網頁即可看到更新

就這麼簡單！🚀
