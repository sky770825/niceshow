<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>餐車圖片管理後台</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="admin-header-content">
                <h1>🍽️ 餐車圖片管理後台</h1>
                <p>智能化管理跑馬燈中的餐車圖片</p>
            </div>
        </div>

        <div class="admin-content">
            <div id="alertMessage" class="alert"></div>
            
            <div id="syncStatus" class="sync-status" style="display: none;">
                <span id="syncMessage">🔄 資料已同步到前端</span>
            </div>

            <div class="search-filter-section">
                <h3 class="section-title">🔍 搜尋與篩選</h3>
                <div class="search-filter-row">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="搜尋餐車名稱..." class="form-input">
                        <span class="search-icon">🔍</span>
                    </div>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">全部狀態</option>
                        <option value="active">已上架</option>
                        <option value="inactive">已下架</option>
                    </select>
                    <select id="sortBy" class="filter-select">
                        <option value="priority">按優先級</option>
                        <option value="title">按名稱</option>
                        <option value="id">按ID</option>
                    </select>
                    <button class="btn btn-secondary" onclick="clearFilters()">清除篩選</button>
                </div>
            </div>

            <div id="batchActions" class="batch-actions">
                <div class="batch-actions-content">
                    <span class="batch-count">已選擇 <span id="selectedCount">0</span> 個餐車</span>
                    <button class="btn btn-success btn-sm" onclick="batchToggle(true)">批量上架</button>
                    <button class="btn btn-danger btn-sm" onclick="batchToggle(false)">批量下架</button>
                    <button class="btn btn-warning btn-sm" onclick="batchDelete()">批量刪除</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearSelection()">取消選擇</button>
                </div>
            </div>

            <div class="form-section">
                <h3 class="section-title">➕ 新增餐車</h3>
                <form id="addTruckForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="newTruckTitle" class="form-label">餐車名稱</label>
                            <input type="text" id="newTruckTitle" class="form-input" placeholder="例如：酥炸大熱狗" required>
                        </div>
                        <div class="form-group">
                            <label for="newTruckSrc" class="form-label">跑馬燈顯示圖片網址</label>
                            <input type="url" id="newTruckSrc" class="form-input" placeholder="https://example.com/image.jpg" required>
                        </div>
                        <div class="form-group">
                            <label for="newTruckAlt" class="form-label">替代文字</label>
                            <input type="text" id="newTruckAlt" class="form-input" placeholder="圖片描述文字">
                        </div>
                        <div class="form-group">
                            <label for="newTruckImgLink" class="form-label">圖片超連結</label>
                            <input type="url" id="newTruckImgLink" class="form-input" placeholder="https://example.com (選填)">
                        </div>
                    </div>
                    

                    <div style="margin-top: 2rem;">
                        <h4 class="form-section-title">🔗 超連結設定</h4>
                        <p class="form-section-description">為餐車添加最多 3 個社群媒體或官網連結</p>
                        
                        <div class="examples-section">
                            <h5 class="examples-title">常見範例：</h5>
                            <div class="examples-grid">
                                <div class="example-item" onclick="fillExample('官網', 'https://www.example-restaurant.com')">
                                    <span class="example-label">官網</span>
                                    <span class="example-url">官方網站</span>
                                </div>
                                <div class="example-item" onclick="fillExample('FB', 'https://www.facebook.com/restaurantpage')">
                                    <span class="example-label">FB</span>
                                    <span class="example-url">Facebook 粉絲頁</span>
                                </div>
                                <div class="example-item" onclick="fillExample('IG', 'https://www.instagram.com/restaurant_account')">
                                    <span class="example-label">IG</span>
                                    <span class="example-url">Instagram 帳號</span>
                                </div>
                                <div class="example-item" onclick="fillExample('菜單', 'https://www.foodpanda.com.tw/restaurant/menu')">
                                    <span class="example-label">菜單</span>
                                    <span class="example-url">線上菜單</span>
                                </div>
                                <div class="example-item" onclick="fillExample('訂餐', 'https://line.me/R/ti/p/@restaurant')">
                                    <span class="example-label">訂餐</span>
                                    <span class="example-url">LINE 官方帳號</span>
                                </div>
                                <div class="example-item" onclick="fillExample('地圖', 'https://goo.gl/maps/restaurant-location')">
                                    <span class="example-label">地圖</span>
                                    <span class="example-url">Google 地圖</span>
                                </div>
                            </div>
                        </div>

                        <div class="links-container">
                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">1</span>
                                    <span class="link-title">第一個連結</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText1" class="form-label">
                                        <span class="label-icon">🏷️</span>
                                        按鈕文字
                                    </label>
                                    <input type="text" id="newTruckText1" class="form-input" placeholder="官網" maxlength="10">
                                    <div class="input-hint">最多 10 個字</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink1" class="form-label">
                                        <span class="label-icon">🌐</span>
                                        網址
                                    </label>
                                    <input type="url" id="newTruckLink1" class="form-input" placeholder="https://example.com">
                                    <div class="input-hint">選填</div>
                                </div>
                            </div>

                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">2</span>
                                    <span class="link-title">第二個連結</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText2" class="form-label">
                                        <span class="label-icon">🏷️</span>
                                        按鈕文字
                                    </label>
                                    <input type="text" id="newTruckText2" class="form-input" placeholder="FB" maxlength="10">
                                    <div class="input-hint">最多 10 個字</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink2" class="form-label">
                                        <span class="label-icon">🌐</span>
                                        網址
                                    </label>
                                    <input type="url" id="newTruckLink2" class="form-input" placeholder="https://facebook.com">
                                    <div class="input-hint">選填</div>
                                </div>
                            </div>

                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">3</span>
                                    <span class="link-title">第三個連結</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText3" class="form-label">
                                        <span class="label-icon">🏷️</span>
                                        按鈕文字
                                    </label>
                                    <input type="text" id="newTruckText3" class="form-input" placeholder="IG" maxlength="10">
                                    <div class="input-hint">最多 10 個字</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink3" class="form-label">
                                        <span class="label-icon">🌐</span>
                                        網址
                                    </label>
                                    <input type="url" id="newTruckLink3" class="form-input" placeholder="https://instagram.com">
                                    <div class="input-hint">選填</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 資料管理區塊 -->
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: space-between;">
                            <div>
                                <h4 class="form-section-title" style="margin-bottom: 0;">💾 資料管理</h4>
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                                <!-- 主要功能按鈕 -->
                                <button type="submit" class="btn btn-primary">➕ 新增餐車</button>
                                <button type="button" class="btn btn-secondary" onclick="openPostimageUpload()">🖼️ 開啟 Postimage</button>
                                <button type="button" class="btn btn-success" onclick="manualSaveData()">💾 儲存並同步</button>
                                
                                <!-- 更多功能下拉選單 -->
                                <div class="dropdown">
                                    <button type="button" class="btn btn-secondary dropdown-toggle" onclick="toggleDropdown('moreFunctions')">
                                        ⚙️ 更多功能 <span class="dropdown-arrow">▼</span>
                                    </button>
                                    <div id="moreFunctions" class="dropdown-menu">
                                        <div class="dropdown-section">
                                            <div class="dropdown-section-title">🔄 同步功能</div>
                                            <button type="button" class="dropdown-item" onclick="checkForUpdates()">🔄 檢查更新</button>
                                            <button type="button" class="dropdown-item" onclick="testSyncFunction()">🧪 測試同步</button>
                                        </div>
                                        <div class="dropdown-section">
                                            <div class="dropdown-section-title">🔑 Token 管理</div>
                                            <button type="button" class="dropdown-item" onclick="setupGitHubToken()">🔑 設定 Token</button>
                                            <button type="button" class="dropdown-item" onclick="openTokenSetup()">🔧 開啟 Token 設定頁</button>
                                            <button type="button" class="dropdown-item" onclick="exportToken()">📤 匯出 Token</button>
                                            <button type="button" class="dropdown-item" onclick="importToken()">📥 匯入 Token</button>
                                            <button type="button" class="dropdown-item" onclick="showTokenStatus()">🔍 檢查 Token 狀態</button>
                                            <button type="button" class="dropdown-item" onclick="window.open('token-guide.html', '_blank')">📖 Token 設定指南</button>
                                        </div>
                                        <div class="dropdown-section">
                                            <div class="dropdown-section-title">📁 資料管理</div>
                                            <button type="button" class="dropdown-item" onclick="saveFoodTruckData()">📥 匯出資料</button>
                                            <button type="button" class="dropdown-item" onclick="location.reload()">🔄 重新載入</button>
                                        </div>
                                        <div class="dropdown-section">
                                            <div class="dropdown-section-title">🖱️ 拖曳功能</div>
                                            <button type="button" class="dropdown-item" onclick="showDragHelp()">🖱️ 拖曳排序說明</button>
                                        </div>
                                        <div class="dropdown-section">
                                            <div class="dropdown-section-title">⚙️ 進階設定</div>
                                            <button type="button" class="dropdown-item" onclick="toggleDebugSection()">🔧 切換除錯功能</button>
                                        </div>
                                        <div class="dropdown-section" style="display: none;" id="debugSection">
                                            <div class="dropdown-section-title">🔧 除錯功能</div>
                                            <button type="button" class="dropdown-item" onclick="debugDataStatus()">🔍 檢查狀態</button>
                                            <button type="button" class="dropdown-item" onclick="forceReloadData()">🔄 強制重新載入</button>
                                            <button type="button" class="dropdown-item" onclick="clearLocalData()">🗑️ 清除本地資料</button>
                                            <button type="button" class="dropdown-item" onclick="testDataJsonLoad()">🧪 測試 data.json 載入</button>
                                            <button type="button" class="dropdown-item" onclick="testDragSort()">🧪 測試拖曳排序</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <strong>✅ 自動儲存：</strong>所有編輯操作都會自動儲存並同步到遠端（如果已設定 Token）
                        </div>
                    </div>
                </form>
            </div>

            <div class="truck-grid" id="truckGrid">
                <!-- 餐車卡片將由JavaScript動態生成 -->
            </div>

            <div class="preview-section">
                <h3 class="section-title">🎬 跑馬燈預覽</h3>
                <div class="marquee-preview">
                    <div class="marquee-track-preview" id="marqueePreview">
                        <!-- 預覽圖片將由JavaScript動態生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="imageModal" class="modal" onclick="hideImageModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="hideImageModal()">&times;</button>
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <!-- 載入其他模組 -->
    <script src="backup_current/auto-setup-token.js"></script>
    <script src="backup_current/update-checker.js"></script>
    
    <!-- 主要 JavaScript 代碼 -->
    <script src="admin.js"></script>
</body>
</html>