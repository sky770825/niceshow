<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒæ­¥åŠŸèƒ½æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            font-weight: 500;
        }
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .log {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª åŒæ­¥åŠŸèƒ½æ¸¬è©¦é é¢</h1>
        <p>æ­¤é é¢ç”¨æ–¼æ¸¬è©¦ GitHub åŒæ­¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸é‹ä½œ</p>
        
        <div id="status" class="status status-info">
            ğŸ”„ æº–å‚™æ¸¬è©¦åŒæ­¥åŠŸèƒ½...
        </div>
        
        <div>
            <h3>ğŸ”§ åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</h3>
            <button class="btn" onclick="testProjectConfig()">æ¸¬è©¦å°ˆæ¡ˆè¨­å®š</button>
            <button class="btn" onclick="testGitHubSync()">æ¸¬è©¦ GitHub åŒæ­¥</button>
            <button class="btn btn-warning" onclick="testTokenValidation()">æ¸¬è©¦ Token é©—è­‰</button>
            <button class="btn btn-success" onclick="testDataSync()">æ¸¬è©¦è³‡æ–™åŒæ­¥</button>
        </div>
        
        <div>
            <h3>ğŸ”„ åŒæ­¥åŠŸèƒ½æ¸¬è©¦</h3>
            <button class="btn" onclick="testCheckUpdates()">æª¢æŸ¥é ç«¯æ›´æ–°</button>
            <button class="btn" onclick="testPullData()">æ‹‰å–é ç«¯è³‡æ–™</button>
            <button class="btn btn-danger" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div>
            <h3>ğŸ“Š æ¸¬è©¦æ—¥èªŒ</h3>
            <div id="log" class="log">ç­‰å¾…æ¸¬è©¦é–‹å§‹...\n</div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„æ¨¡çµ„ -->
    <script src="project-config.js"></script>
    <script src="github-sync.js"></script>
    
    <script>
        let logElement = document.getElementById('log');
        let statusElement = document.getElementById('status');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            statusElement.textContent = message;
            statusElement.className = `status status-${type}`;
        }
        
        function clearLog() {
            logElement.textContent = 'æ—¥èªŒå·²æ¸…é™¤\n';
        }
        
        // æ¸¬è©¦å°ˆæ¡ˆè¨­å®š
        function testProjectConfig() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦å°ˆæ¡ˆè¨­å®š...');
            
            try {
                const config = projectConfig.load();
                if (config) {
                    log(`âœ… å°ˆæ¡ˆè¨­å®šè¼‰å…¥æˆåŠŸ: ${config.currentProject.name}`);
                    log(`ğŸ“ å€‰åº«: ${config.currentProject.repository}`);
                    log(`ğŸŒ ç¶²ç«™: ${config.currentProject.website}`);
                    updateStatus('âœ… å°ˆæ¡ˆè¨­å®šæ¸¬è©¦é€šé', 'success');
                } else {
                    throw new Error('å°ˆæ¡ˆè¨­å®šè¼‰å…¥å¤±æ•—');
                }
            } catch (error) {
                log(`âŒ å°ˆæ¡ˆè¨­å®šæ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ å°ˆæ¡ˆè¨­å®šæ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦ GitHub åŒæ­¥æ¨¡çµ„
        function testGitHubSync() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦ GitHub åŒæ­¥æ¨¡çµ„...');
            
            try {
                if (typeof githubSync === 'undefined') {
                    throw new Error('GitHub åŒæ­¥æ¨¡çµ„æœªè¼‰å…¥');
                }
                
                const status = githubSync.getProjectStatus();
                log(`ğŸ“Š å°ˆæ¡ˆç‹€æ…‹: ${JSON.stringify(status, null, 2)}`);
                
                if (status.hasProject) {
                    log('âœ… GitHub åŒæ­¥æ¨¡çµ„è¼‰å…¥æˆåŠŸ');
                    updateStatus('âœ… GitHub åŒæ­¥æ¨¡çµ„æ¸¬è©¦é€šé', 'success');
                } else {
                    throw new Error('æœªæ‰¾åˆ°å°ˆæ¡ˆè¨­å®š');
                }
            } catch (error) {
                log(`âŒ GitHub åŒæ­¥æ¨¡çµ„æ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ GitHub åŒæ­¥æ¨¡çµ„æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦ Token é©—è­‰
        async function testTokenValidation() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦ Token é©—è­‰...');
            
            try {
                if (!githubSync.token) {
                    log('âš ï¸ æœªè¨­å®š Tokenï¼Œè«‹å…ˆè¨­å®š');
                    updateStatus('âš ï¸ è«‹å…ˆè¨­å®š GitHub Token', 'error');
                    return;
                }
                
                log('ğŸ”„ æ­£åœ¨é©—è­‰ Token...');
                const validation = await githubSync.validateToken();
                
                if (validation.valid) {
                    log(`âœ… Token é©—è­‰æˆåŠŸ: ${validation.user}`);
                    updateStatus('âœ… Token é©—è­‰é€šé', 'success');
                } else {
                    log(`âŒ Token é©—è­‰å¤±æ•—: ${validation.message}`);
                    updateStatus('âŒ Token é©—è­‰å¤±æ•—', 'error');
                }
            } catch (error) {
                log(`âŒ Token é©—è­‰æ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ Token é©—è­‰æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦è³‡æ–™åŒæ­¥
        async function testDataSync() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦è³‡æ–™åŒæ­¥...');
            
            try {
                if (!githubSync.token) {
                    log('âš ï¸ æœªè¨­å®š Tokenï¼Œè·³éåŒæ­¥æ¸¬è©¦');
                    updateStatus('âš ï¸ è«‹å…ˆè¨­å®š GitHub Token', 'error');
                    return;
                }
                
                const testData = {
                    foodTrucks: [
                        {
                            id: 'test_truck_' + Date.now(),
                            title: 'æ¸¬è©¦é¤è»Š',
                            src: 'https://via.placeholder.com/200x120/3b82f6/ffffff?text=æ¸¬è©¦åœ–ç‰‡',
                            alt: 'æ¸¬è©¦é¤è»Šåœ–ç‰‡',
                            isActive: true,
                            priority: 1,
                            category: 'test'
                        }
                    ],
                    lastUpdated: new Date().toISOString()
                };
                
                log('ğŸ”„ æ­£åœ¨åŒæ­¥æ¸¬è©¦è³‡æ–™...');
                const result = await githubSync.syncData(testData, 'test-data.json');
                
                log(`âœ… è³‡æ–™åŒæ­¥æˆåŠŸ: ${result.commitUrl}`);
                updateStatus('âœ… è³‡æ–™åŒæ­¥æ¸¬è©¦é€šé', 'success');
            } catch (error) {
                log(`âŒ è³‡æ–™åŒæ­¥æ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ è³‡æ–™åŒæ­¥æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦æª¢æŸ¥æ›´æ–°
        async function testCheckUpdates() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦æª¢æŸ¥æ›´æ–°...');
            
            try {
                if (!githubSync.token) {
                    log('âš ï¸ æœªè¨­å®š Tokenï¼Œè·³éæª¢æŸ¥æ›´æ–°æ¸¬è©¦');
                    updateStatus('âš ï¸ è«‹å…ˆè¨­å®š GitHub Token', 'error');
                    return;
                }
                
                log('ğŸ”„ æ­£åœ¨æª¢æŸ¥é ç«¯æ›´æ–°...');
                const updateInfo = await githubSync.checkForUpdates('data.json');
                
                log(`ğŸ“Š æ›´æ–°è³‡è¨Š: ${JSON.stringify(updateInfo, null, 2)}`);
                
                if (updateInfo.hasUpdate) {
                    log('ğŸ†• ç™¼ç¾é ç«¯æ›´æ–°');
                    updateStatus('ğŸ†• ç™¼ç¾é ç«¯æ›´æ–°', 'info');
                } else {
                    log('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                    updateStatus('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬', 'success');
                }
            } catch (error) {
                log(`âŒ æª¢æŸ¥æ›´æ–°æ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ æª¢æŸ¥æ›´æ–°æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦æ‹‰å–è³‡æ–™
        async function testPullData() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦æ‹‰å–è³‡æ–™...');
            
            try {
                if (!githubSync.token) {
                    log('âš ï¸ æœªè¨­å®š Tokenï¼Œè·³éæ‹‰å–è³‡æ–™æ¸¬è©¦');
                    updateStatus('âš ï¸ è«‹å…ˆè¨­å®š GitHub Token', 'error');
                    return;
                }
                
                log('ğŸ”„ æ­£åœ¨æ‹‰å–é ç«¯è³‡æ–™...');
                const result = await githubSync.pullData('data.json');
                
                log(`âœ… è³‡æ–™æ‹‰å–æˆåŠŸï¼Œå¤§å°: ${result.content.length} å­—å…ƒ`);
                log(`ğŸ“ SHA: ${result.sha}`);
                updateStatus('âœ… è³‡æ–™æ‹‰å–æ¸¬è©¦é€šé', 'success');
            } catch (error) {
                log(`âŒ è³‡æ–™æ‹‰å–æ¸¬è©¦å¤±æ•—: ${error.message}`);
                updateStatus('âŒ è³‡æ–™æ‹‰å–æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ åŒæ­¥åŠŸèƒ½æ¸¬è©¦é é¢å·²è¼‰å…¥');
            log('ğŸ’¡ è«‹ä¾åºé»æ“ŠæŒ‰éˆ•é€²è¡Œæ¸¬è©¦');
            
            // åˆå§‹åŒ–å°ˆæ¡ˆè¨­å®š
            if (typeof projectConfig !== 'undefined') {
                projectConfig.initialize();
                log('âœ… å°ˆæ¡ˆè¨­å®šå·²åˆå§‹åŒ–');
            }
        });
    </script>
</body>
</html>
