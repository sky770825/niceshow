<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤è»Šåœ–ç‰‡ç®¡ç†å¾Œå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --success-color: #10b981;
            --success-dark: #059669;
            --danger-color: #ef4444;
            --danger-dark: #dc2626;
            --warning-color: #f59e0b;
            --warning-dark: #d97706;
            --secondary-color: #64748b;
            --secondary-dark: #475569;
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-hover: #f1f5f9;
            --border: #e2e8f0;
            --border-hover: #cbd5e1;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-light: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* æ™ºèƒ½å®¹å™¨ä½ˆå±€ */
        .admin-container {
            max-width: min(95vw, 1200px);
            margin: 0 auto;
            background: var(--surface);
            min-height: 100vh;
            box-shadow: var(--shadow-lg);
        }

        /* éŸ¿æ‡‰å¼æ¨™é¡Œå€ */
        .admin-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: clamp(1rem, 4vw, 2rem);
            position: relative;
            overflow: hidden;
        }

        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="pattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23pattern)"/></svg>');
            pointer-events: none;
        }

        .admin-header-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .admin-header h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .admin-header p {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            opacity: 0.9;
            font-weight: 300;
        }

        /* æ™ºèƒ½å…§å®¹ä½ˆå±€ */
        .admin-content {
            padding: clamp(1rem, 3vw, 2rem);
            display: flex;
            flex-direction: column;
            gap: clamp(1rem, 2vw, 1.5rem);
        }

        /* æ™ºèƒ½çµ±è¨ˆå¡ç‰‡ç¶²æ ¼ */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(150px, 100%), 1fr));
            gap: clamp(0.75rem, 2vw, 1.5rem);
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: clamp(0.75rem, 3vw, 1.5rem);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            aspect-ratio: 3/2;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--border-hover);
        }

        .stat-number {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: clamp(0.7rem, 2vw, 0.875rem);
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* æ™ºèƒ½æœå°‹å€åŸŸ */
        .search-filter-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: clamp(0.75rem, 3vw, 1.5rem);
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-size: clamp(1rem, 3vw, 1.25rem);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* æ™ºèƒ½æœå°‹ç¶²æ ¼ */
        .search-filter-row {
            display: grid;
            grid-template-columns: 
                minmax(0, 2fr) 
                minmax(min-content, 1fr) 
                minmax(min-content, 1fr) 
                min-content;
            gap: clamp(0.5rem, 2vw, 1rem);
            align-items: end;
        }

        @media (max-width: 768px) {
            .search-filter-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }

        .search-box {
            position: relative;
            min-width: 0;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: clamp(0.875rem, 2vw, 1rem);
            transition: all 0.3s ease;
            background: var(--surface);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            pointer-events: none;
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: clamp(0.875rem, 2vw, 1rem);
            background: var(--surface);
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* æ™ºèƒ½æŒ‰éˆ•ç³»çµ± */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: clamp(0.5rem, 2vw, 0.75rem) clamp(0.75rem, 3vw, 1.5rem);
            border: none;
            border-radius: 8px;
            font-size: clamp(0.75rem, 2vw, 0.875rem);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
            min-height: 44px; /* è§¸æ§å‹å¥½å°ºå¯¸ */
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success-color); color: white; }
        .btn-success:hover { background: var(--success-dark); }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-danger:hover { background: var(--danger-dark); }
        .btn-warning { background: var(--warning-color); color: white; }
        .btn-warning:hover { background: var(--warning-dark); }
        .btn-secondary { background: var(--secondary-color); color: white; }
        .btn-secondary:hover { background: var(--secondary-dark); }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            min-height: 36px;
        }

        /* æ™ºèƒ½é¤è»Šç¶²æ ¼ - 5æ¬„ç·Šæ¹Šç‰ˆ */
        .truck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(200px, 100%), 1fr));
            gap: clamp(0.5rem, 1.5vw, 1rem);
        }

        .truck-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .truck-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-hover);
        }

        .truck-card.active { border-color: var(--success-color); }
        .truck-card.inactive { border-color: var(--danger-color); opacity: 0.7; }
        .truck-card.selected { border-color: var(--primary-color); background: rgba(59, 130, 246, 0.05); }

        .truck-image-container {
            position: relative;
            height: clamp(80px, 15vw, 120px);
            overflow: hidden;
            background: var(--surface-hover);
        }

        .truck-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .truck-card:hover .truck-image {
            transform: scale(1.05);
        }

        .truck-priority-badge {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            z-index: 2;
        }

        .truck-checkbox {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 16px;
            height: 16px;
            z-index: 2;
            cursor: pointer;
        }

        .truck-info {
            padding: clamp(0.5rem, 2vw, 0.75rem);
        }

        .truck-title {
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            line-height: 1.3;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .truck-title:hover {
            color: var(--primary-color);
        }

        .truck-alt {
            font-size: clamp(0.65rem, 1.5vw, 0.75rem);
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            line-height: 1.2;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .truck-links {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .truck-link-btn {
            padding: 0.15rem 0.4rem;
            font-size: 0.65rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--surface-hover);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .truck-link-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            background: rgba(59, 130, 246, 0.05);
        }

        .truck-actions {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .status-badge {
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .move-buttons {
            position: absolute;
            top: 50%;
            right: 0.5rem;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            z-index: 3;
        }

        .move-btn {
            width: 18px;
            height: 18px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            line-height: 1;
            border: none;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .move-btn:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        /* å…§è¯ç·¨è¼¯æ¨£å¼ */
        .truck-card.editing {
            border-color: var(--warning-color);
            background: rgba(245, 158, 11, 0.05);
        }

        .truck-card.editing .truck-title-input,
        .truck-card.editing .truck-alt-input,
        .truck-card.editing .truck-link-input {
            width: 100%;
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: inherit;
            background: var(--surface);
            margin-bottom: 0.25rem;
            user-select: text;
        }

        .truck-card.editing .truck-title-input {
            font-weight: 600;
            font-size: clamp(0.75rem, 2vw, 0.9rem);
        }

        .truck-card.editing .truck-alt-input {
            font-size: clamp(0.65rem, 1.5vw, 0.75rem);
            height: 60px;
            resize: vertical;
        }

        .truck-card.editing .truck-link-input {
            font-size: 0.65rem;
            margin-bottom: 0.15rem;
        }

        .truck-card.editing .edit-links-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .truck-card.editing .edit-link-group {
            display: contents;
        }

        .truck-card.editing .edit-link-label {
            font-size: 0.6rem;
            color: var(--text-secondary);
            margin-bottom: 0.1rem;
        }

        /* ç·Šæ¹ŠæŒ‰éˆ•æ¨£å¼ */
        .truck-actions .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.65rem;
            min-height: 24px;
            border-radius: 6px;
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 480px) {
            .truck-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .truck-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .truck-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 0.75rem;
            }
        }

        @media (min-width: 1025px) {
            .truck-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 1rem;
            }
        }

        /* æ™ºèƒ½è¡¨å–®ä½ˆå±€ */
        .form-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: clamp(1rem, 3vw, 1.5rem);
            box-shadow: var(--shadow-sm);
        }

        .form-section-title {
            font-size: clamp(1rem, 3vw, 1.125rem);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-section-description {
            font-size: clamp(0.8rem, 2vw, 0.875rem);
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        /* æ™ºèƒ½è¡¨å–®ç¶²æ ¼ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(240px, 100%), 1fr));
            gap: clamp(0.75rem, 2vw, 1rem);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: clamp(0.8rem, 2vw, 0.875rem);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .label-icon {
            font-size: 0.75rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: clamp(0.875rem, 2vw, 1rem);
            transition: all 0.3s ease;
            background: var(--surface);
            min-height: 44px; /* è§¸æ§å‹å¥½ */
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-hint {
            font-size: clamp(0.7rem, 2vw, 0.75rem);
            color: var(--text-light);
            margin-top: 0.25rem;
            font-style: italic;
        }

        /* æ™ºèƒ½ç¯„ä¾‹å€åŸŸ */
        .examples-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.15);
            border-radius: 12px;
            padding: clamp(1rem, 3vw, 1.25rem);
            margin-bottom: 1.5rem;
        }

        .examples-title {
            font-size: clamp(0.9rem, 2vw, 1rem);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .examples-title::before {
            content: "ğŸ’¡";
            font-size: 1rem;
        }

        /* æ™ºèƒ½ç¯„ä¾‹ç¶²æ ¼ */
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(120px, 100%), 1fr));
            gap: clamp(0.5rem, 2vw, 0.75rem);
        }

        .example-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: clamp(0.5rem, 2vw, 0.75rem);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .example-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .example-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .example-item:hover::before {
            transform: scaleX(1);
        }

        .example-label {
            display: block;
            font-size: clamp(0.75rem, 2vw, 0.875rem);
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .example-url {
            display: block;
            font-size: clamp(0.65rem, 1.5vw, 0.75rem);
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* 3æ¬„é€£çµä½ˆå±€ */
        .links-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: clamp(0.75rem, 2vw, 1.5rem);
            margin-bottom: 1rem;
        }

        .link-column {
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: clamp(0.75rem, 2vw, 1rem);
            transition: all 0.3s ease;
        }

        .link-column:hover {
            border-color: var(--border-hover);
            box-shadow: var(--shadow-sm);
        }

        .link-column .link-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .link-column .link-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0;
        }

        .link-column .link-title {
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            font-weight: 600;
            color: var(--text-primary);
        }

        .link-column .form-group {
            margin-bottom: 0.75rem;
        }

        .link-column .form-input {
            padding: 0.5rem 0.75rem;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            min-height: 36px;
        }

        .link-column .form-label {
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            margin-bottom: 0.3rem;
        }

        .link-column .input-hint {
            font-size: clamp(0.65rem, 1.5vw, 0.7rem);
            margin-top: 0.15rem;
        }

        /* æ‰‹æ©Ÿç‰ˆæ”¹ç‚ºå‚ç›´æ’åˆ— */
        @media (max-width: 768px) {
            .links-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* å¹³æ¿ç‰ˆæ”¹ç‚º2æ¬„ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .links-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .link-column:nth-child(3) {
                grid-column: 1 / -1;
                max-width: 50%;
                margin: 0 auto;
            }
        }

        /* æ™ºèƒ½æ‰¹é‡æ“ä½œ */
        .batch-actions {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: clamp(0.75rem, 3vw, 1rem);
            display: none;
        }

        .batch-actions.show {
            display: block;
        }

        .batch-actions-content {
            display: flex;
            gap: clamp(0.5rem, 2vw, 1rem);
            align-items: center;
            flex-wrap: wrap;
        }

        .batch-count {
            font-weight: 600;
            color: var(--primary-color);
            font-size: clamp(0.85rem, 2vw, 1rem);
        }

        /* æ™ºèƒ½é è¦½å€åŸŸ */
        .preview-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: clamp(1rem, 3vw, 1.5rem);
            box-shadow: var(--shadow-sm);
        }

        .marquee-preview {
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: clamp(0.75rem, 2vw, 1rem);
            overflow: hidden;
            margin-top: 1rem;
        }

        .marquee-track-preview {
            display: flex;
            gap: 1rem;
            animation: marquee-scroll 20s linear infinite;
        }

        .marquee-item-preview {
            flex-shrink: 0;
            width: clamp(60px, 10vw, 80px);
            height: clamp(45px, 7.5vw, 60px);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .marquee-item-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes marquee-scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* æ™ºèƒ½æ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: clamp(1rem, 5vw, 2rem);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            position: relative;
            max-width: min(90vw, 800px);
            max-height: 90vh;
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content img {
            width: 100%;
            height: auto;
            max-height: 80vh;
            object-fit: contain;
            display: block;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* æ™ºèƒ½é€šçŸ¥ç³»çµ± */
        .alert {
            padding: clamp(0.75rem, 2vw, 1rem);
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            font-weight: 500;
            border: 1px solid;
            font-size: clamp(0.85rem, 2vw, 1rem);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .sync-status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideInRight 0.3s ease;
            font-weight: 500;
            font-size: clamp(0.85rem, 2vw, 1rem);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .example-item.clicked {
            animation: clickAnimation 0.3s ease;
        }

        @keyframes clickAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* å®¹å™¨æŸ¥è©¢æ”¯æ´ */
        @container (max-width: 600px) {
            .truck-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
        }

        /* é«˜å°æ¯”åº¦æ¨¡å¼æ”¯æ´ */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --text-secondary: #000000;
            }
        }

        /* æ¸›å°‘å‹•ç•«åå¥½ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* æ·±è‰²æ¨¡å¼æ”¯æ´ */
        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0f172a;
                --surface: #1e293b;
                --surface-hover: #334155;
                --border: #475569;
                --border-hover: #64748b;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-light: #94a3b8;
            }
        }

        /* å°ˆç‚ºè¡Œå‹•è£ç½®å„ªåŒ– */
        @media (max-width: 480px) {
            .admin-container {
                margin: 0;
                border-radius: 0;
            }
            
            .truck-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filter-row {
                grid-template-columns: 1fr;
            }
            
            .batch-actions-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .examples-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* å¹³æ¿æ©«å‘å„ªåŒ– */
        @media (min-width: 768px) and (max-width: 1024px) {
            .truck-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* å¤§è¢å¹•å„ªåŒ– */
        @media (min-width: 1400px) {
            .admin-container {
                max-width: 1400px;
            }
            
            .truck-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }

        /* å°åˆ·æ¨£å¼ */
        @media print {
            .admin-header,
            .batch-actions,
            .btn,
            .move-buttons,
            .sync-status {
                display: none !important;
            }
            
            .truck-card {
                break-inside: avoid;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="admin-header-content">
                <h1>ğŸ½ï¸ é¤è»Šåœ–ç‰‡ç®¡ç†å¾Œå°</h1>
                <p>æ™ºèƒ½åŒ–ç®¡ç†è·‘é¦¬ç‡ˆä¸­çš„é¤è»Šåœ–ç‰‡</p>
            </div>
        </div>

        <div class="admin-content">
            <div id="alertMessage" class="alert"></div>
            
            <div id="syncStatus" class="sync-status" style="display: none;">
                <span id="syncMessage">ğŸ”„ è³‡æ–™å·²åŒæ­¥åˆ°å‰ç«¯</span>
            </div>

            <div class="search-filter-section">
                <h3 class="section-title">ğŸ” æœå°‹èˆ‡ç¯©é¸</h3>
                <div class="search-filter-row">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="æœå°‹é¤è»Šåç¨±..." class="form-input">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">å…¨éƒ¨ç‹€æ…‹</option>
                        <option value="active">å·²ä¸Šæ¶</option>
                        <option value="inactive">å·²ä¸‹æ¶</option>
                    </select>
                    <select id="sortBy" class="filter-select">
                        <option value="priority">æŒ‰å„ªå…ˆç´š</option>
                        <option value="title">æŒ‰åç¨±</option>
                        <option value="id">æŒ‰ID</option>
                    </select>
                    <button class="btn btn-secondary" onclick="clearFilters()">æ¸…é™¤ç¯©é¸</button>
                </div>
            </div>

            <div id="batchActions" class="batch-actions">
                <div class="batch-actions-content">
                    <span class="batch-count">å·²é¸æ“‡ <span id="selectedCount">0</span> å€‹é¤è»Š</span>
                    <button class="btn btn-success btn-sm" onclick="batchToggle(true)">æ‰¹é‡ä¸Šæ¶</button>
                    <button class="btn btn-danger btn-sm" onclick="batchToggle(false)">æ‰¹é‡ä¸‹æ¶</button>
                    <button class="btn btn-warning btn-sm" onclick="batchDelete()">æ‰¹é‡åˆªé™¤</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearSelection()">å–æ¶ˆé¸æ“‡</button>
                </div>
            </div>

            <div class="form-section">
                <h3 class="section-title">â• æ–°å¢é¤è»Š</h3>
                <form id="addTruckForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="newTruckTitle" class="form-label">é¤è»Šåç¨±</label>
                            <input type="text" id="newTruckTitle" class="form-input" placeholder="ä¾‹å¦‚ï¼šé…¥ç‚¸å¤§ç†±ç‹—" required>
                        </div>
                        <div class="form-group">
                            <label for="newTruckSrc" class="form-label">è·‘é¦¬ç‡ˆé¡¯ç¤ºåœ–ç‰‡ç¶²å€</label>
                            <input type="url" id="newTruckSrc" class="form-input" placeholder="https://example.com/image.jpg" required>
                        </div>
                        <div class="form-group">
                            <label for="newTruckAlt" class="form-label">æ›¿ä»£æ–‡å­—</label>
                            <input type="text" id="newTruckAlt" class="form-input" placeholder="åœ–ç‰‡æè¿°æ–‡å­—">
                        </div>
                        <div class="form-group">
                            <label for="newTruckImgLink" class="form-label">åœ–ç‰‡è¶…é€£çµ</label>
                            <input type="url" id="newTruckImgLink" class="form-input" placeholder="https://example.com (é¸å¡«)">
                        </div>
                    </div>
                    

                    <div style="margin-top: 2rem;">
                        <h4 class="form-section-title">ğŸ”— è¶…é€£çµè¨­å®š</h4>
                        <p class="form-section-description">ç‚ºé¤è»Šæ·»åŠ æœ€å¤š 3 å€‹ç¤¾ç¾¤åª’é«”æˆ–å®˜ç¶²é€£çµ</p>
                        
                        <div class="examples-section">
                            <h5 class="examples-title">å¸¸è¦‹ç¯„ä¾‹ï¼š</h5>
                            <div class="examples-grid">
                                <div class="example-item" onclick="fillExample('å®˜ç¶²', 'https://www.example-restaurant.com')">
                                    <span class="example-label">å®˜ç¶²</span>
                                    <span class="example-url">å®˜æ–¹ç¶²ç«™</span>
                                </div>
                                <div class="example-item" onclick="fillExample('FB', 'https://www.facebook.com/restaurantpage')">
                                    <span class="example-label">FB</span>
                                    <span class="example-url">Facebook ç²‰çµ²é </span>
                                </div>
                                <div class="example-item" onclick="fillExample('IG', 'https://www.instagram.com/restaurant_account')">
                                    <span class="example-label">IG</span>
                                    <span class="example-url">Instagram å¸³è™Ÿ</span>
                                </div>
                                <div class="example-item" onclick="fillExample('èœå–®', 'https://www.foodpanda.com.tw/restaurant/menu')">
                                    <span class="example-label">èœå–®</span>
                                    <span class="example-url">ç·šä¸Šèœå–®</span>
                                </div>
                                <div class="example-item" onclick="fillExample('è¨‚é¤', 'https://line.me/R/ti/p/@restaurant')">
                                    <span class="example-label">è¨‚é¤</span>
                                    <span class="example-url">LINE å®˜æ–¹å¸³è™Ÿ</span>
                                </div>
                                <div class="example-item" onclick="fillExample('åœ°åœ–', 'https://goo.gl/maps/restaurant-location')">
                                    <span class="example-label">åœ°åœ–</span>
                                    <span class="example-url">Google åœ°åœ–</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 3æ¬„é€£çµä½ˆå±€ -->
                        <div class="links-container">
                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">1</span>
                                    <span class="link-title">ç¬¬ä¸€å€‹é€£çµ</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText1" class="form-label">
                                        <span class="label-icon">ğŸ·ï¸</span>
                                        æŒ‰éˆ•æ–‡å­—
                                    </label>
                                    <input type="text" id="newTruckText1" class="form-input" placeholder="å®˜ç¶²" maxlength="10">
                                    <div class="input-hint">æœ€å¤š 10 å€‹å­—</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink1" class="form-label">
                                        <span class="label-icon">ğŸŒ</span>
                                        ç¶²å€
                                    </label>
                                    <input type="url" id="newTruckLink1" class="form-input" placeholder="https://example.com">
                                    <div class="input-hint">é¸å¡«</div>
                                </div>
                            </div>

                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">2</span>
                                    <span class="link-title">ç¬¬äºŒå€‹é€£çµ</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText2" class="form-label">
                                        <span class="label-icon">ğŸ·ï¸</span>
                                        æŒ‰éˆ•æ–‡å­—
                                    </label>
                                    <input type="text" id="newTruckText2" class="form-input" placeholder="FB" maxlength="10">
                                    <div class="input-hint">æœ€å¤š 10 å€‹å­—</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink2" class="form-label">
                                        <span class="label-icon">ğŸŒ</span>
                                        ç¶²å€
                                    </label>
                                    <input type="url" id="newTruckLink2" class="form-input" placeholder="https://facebook.com">
                                    <div class="input-hint">é¸å¡«</div>
                                </div>
                            </div>

                            <div class="link-column">
                                <div class="link-header">
                                    <span class="link-number">3</span>
                                    <span class="link-title">ç¬¬ä¸‰å€‹é€£çµ</span>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckText3" class="form-label">
                                        <span class="label-icon">ğŸ·ï¸</span>
                                        æŒ‰éˆ•æ–‡å­—
                                    </label>
                                    <input type="text" id="newTruckText3" class="form-input" placeholder="IG" maxlength="10">
                                    <div class="input-hint">æœ€å¤š 10 å€‹å­—</div>
                                </div>
                                <div class="form-group">
                                    <label for="newTruckLink3" class="form-label">
                                        <span class="label-icon">ğŸŒ</span>
                                        ç¶²å€
                                    </label>
                                    <input type="url" id="newTruckLink3" class="form-input" placeholder="https://instagram.com">
                                    <div class="input-hint">é¸å¡«</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è³‡æ–™ç®¡ç†å€å¡Š -->
                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: space-between;">
                            <div>
                                <h4 class="form-section-title" style="margin-bottom: 0;">ğŸ’¾ è³‡æ–™ç®¡ç†</h4>
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button type="submit" class="btn btn-primary">â• æ–°å¢é¤è»Š</button>
                                <button type="button" class="btn btn-secondary" onclick="openPostimageUpload()">ğŸ–¼ï¸ é–‹å•Ÿ Postimage</button>
                                <button type="button" class="btn btn-success" onclick="manualSaveData()">ğŸ’¾ å„²å­˜ä¸¦åŒæ­¥</button>
                                <button type="button" class="btn btn-warning" onclick="checkForUpdates()">ğŸ”„ æª¢æŸ¥æ›´æ–°</button>
                                <button type="button" class="btn btn-secondary" onclick="setupGitHubToken()">ğŸ”‘ è¨­å®š Token</button>
                                <button type="button" class="btn btn-info" onclick="openTokenSetup()">ğŸ”§ é–‹å•Ÿ Token è¨­å®šé </button>
                                <button type="button" class="btn btn-secondary" onclick="debugDataStatus()">ğŸ” æª¢æŸ¥ç‹€æ…‹</button>
                                <button type="button" class="btn btn-warning" onclick="forceReloadData()">ğŸ”„ å¼·åˆ¶é‡æ–°è¼‰å…¥</button>
                                <button type="button" class="btn btn-secondary" onclick="saveFoodTruckData()">ğŸ“¥ åŒ¯å‡ºè³‡æ–™</button>
                                <button type="button" class="btn btn-secondary" onclick="location.reload()">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                            </div>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <strong>âœ… è‡ªå‹•å„²å­˜ï¼š</strong>æ‰€æœ‰ç·¨è¼¯æ“ä½œéƒ½æœƒè‡ªå‹•å„²å­˜ä¸¦åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                        </div>
                    </div>
                </form>
            </div>

            <div class="truck-grid" id="truckGrid">
                <!-- é¤è»Šå¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>

            <div class="preview-section">
                <h3 class="section-title">ğŸ¬ è·‘é¦¬ç‡ˆé è¦½</h3>
                <div class="marquee-preview">
                    <div class="marquee-track-preview" id="marqueePreview">
                        <!-- é è¦½åœ–ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="imageModal" class="modal" onclick="hideImageModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="hideImageModal()">&times;</button>
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <!-- è¼‰å…¥å°ˆæ¡ˆè¨­å®šå’Œ GitHub åŒæ­¥æ¨¡çµ„ -->
    <script src="project-config.js"></script>
    <script src="github-sync.js"></script>
    <script src="auto-setup-token.js"></script>
    <script src="update-checker.js"></script>
    
    <script>
        // é è¨­é¤è»Šè³‡æ–™åº«ï¼ˆå‚™ç”¨è³‡æ–™ï¼Œä¸»è¦è³‡æ–™ä¾†æºç‚º data.jsonï¼‰
        let foodTruckDatabase = [
            {
                id: 'truck_1758002427365',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1758002363/%E6%88%91%E7%9A%84dm_mfegnq.png',
                alt: 'è¯çµ¡æˆ‘',
                title: 'ç‰ˆä¸»ï¼šè”¡æ¿¬ç‘’',
                link: [
                    {
                        url: 'https://realtor.houseprice.tw/agent/buy/0925666597/',
                        text: 'ç²¾é¸ç‰©ä»¶'
                    },
                    {
                        url: 'https://www.tiktok.com/@aihouse168?is_from_webapp=1&sender_device=pc',
                        text: 'Tiktok'
                    }
                ],
                isActive: true,
                priority: 1,
                category: 'main'
            },
            {
                id: 'truck_001',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990540/S__4653108_0_u5egpg.jpg',
                alt: 'é¤è»Šå“ç‰Œ1',
                title: 'éœ²éœ²å§',
                isActive: true,
                priority: 2,
                category: 'main'
            },
            {
                id: 'truck_002',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990540/S__4653107_0_igxhgl.jpg',
                alt: 'é¤è»Šå“ç‰Œ2',
                title: 'èŠ±ç”Ÿæ²å†°æ·‡æ·‹',
                isActive: true,
                priority: 3,
                category: 'main'
            },
            {
                id: 'truck_003',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990540/S__4653105_0_keaqnp.jpg',
                alt: 'é¤è»Šå“ç‰Œ3',
                title: 'é„­è€çˆ¹ä¹¾éºµ',
                isActive: true,
                priority: 4,
                category: 'main'
            },
            {
                id: 'truck_004',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653102_0_iwonvd.jpg',
                alt: 'é¤è»Šå“ç‰Œ4',
                title: 'è”¬å­Ÿåœ’',
                isActive: true,
                priority: 5,
                category: 'main'
            },
            {
                id: 'truck_005',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653103_0_ste4ns.jpg',
                alt: 'é¤è»Šå“ç‰Œ5',
                title: 'å°æ±æ”¾å±±è±¬',
                isActive: true,
                priority: 6,
                category: 'main'
            },
            {
                id: 'truck_006',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653100_0_ono2dd.jpg',
                alt: 'é¤è»Šå“ç‰Œ6',
                title: 'å®‰å¾·å°¼æ–¯çƒ˜åŸ¹åŠ',
                isActive: true,
                priority: 7,
                category: 'main'
            },
            {
                id: 'truck_007',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653096_0_vycs5h.jpg',
                alt: 'é¤è»Šå“ç‰Œ7',
                title: 'éŸ“å¼é£¯æ²',
                isActive: true,
                priority: 8,
                category: 'main'
            },
            {
                id: 'truck_008',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653098_0_gidf0n.jpg',
                alt: 'é¤è»Šå“ç‰Œ8',
                title: 'ç‚¸è›‹ğ£„ƒé­šé»‘è¼ª',
                isActive: true,
                priority: 9,
                category: 'main'
            },
            {
                id: 'truck_009',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653094_0_mxdtdj.jpg',
                alt: 'é¤è»Šå“ç‰Œ9',
                title: 'å‘é™½å¡åˆˆåŒ…',
                isActive: true,
                priority: 10,
                category: 'main'
            },
            {
                id: 'truck_010',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653099_0_sxppso.jpg',
                alt: 'é¤è»Šå“ç‰Œ10',
                title: 'æ»·æ‹‰æ‹‰',
                isActive: true,
                priority: 11,
                category: 'main'
            },
            {
                id: 'truck_011',
                src: 'https://res.cloudinary.com/db0mzs6ps/image/upload/v1757990539/S__4653095_0_scixck.jpg',
                alt: 'é¤è»Šå“ç‰Œ11',
                title: 'é¤“é£Ÿé¬¼ç¾å‘³è²©è³£æ‰€',
                isActive: true,
                priority: 12,
                category: 'main'
            }
        ];
        let filteredTrucks = [];
        let selectedTrucks = new Set();

        async function loadFoodTruckData(forceRemote = false) {
            console.log('ğŸ”„ é–‹å§‹è¼‰å…¥é¤è»Šè³‡æ–™...');
            
            try {
                // 1. æ ¹æ“šåƒæ•¸æ±ºå®šè¼‰å…¥ç­–ç•¥
                if (forceRemote) {
                    console.log('ğŸŒ å¼·åˆ¶å¾ data.json è¼‰å…¥æœ€æ–°è³‡æ–™...');
                    return await loadFromRemote();
                } else {
                    // æ™ºèƒ½è¼‰å…¥ï¼šå…ˆæª¢æŸ¥é ç«¯ï¼Œå†ä½¿ç”¨æœ¬åœ°
                    console.log('ğŸ§  æ™ºèƒ½è¼‰å…¥ï¼šæª¢æŸ¥é ç«¯æ›´æ–°...');
                    
                    // å…ˆå˜—è©¦å¾é ç«¯è¼‰å…¥
                    try {
                        const remoteResult = await loadFromRemote();
                        if (remoteResult.success) {
                            return remoteResult;
                        }
                    } catch (error) {
                        console.log('âš ï¸ é ç«¯è¼‰å…¥å¤±æ•—ï¼Œå˜—è©¦æœ¬åœ°è¼‰å…¥');
                    }
                    
                    // å¦‚æœé ç«¯è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°è¼‰å…¥
                    return await loadFromLocal();
                }
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥é¤è»Šè³‡æ–™å¤±æ•—:', error);
                return await loadFromDefault();
            }
        }
        
        // å¾é ç«¯è¼‰å…¥è³‡æ–™
        async function loadFromRemote() {
            console.log('ğŸŒ å¾ data.json è¼‰å…¥è³‡æ–™...');
            const response = await fetch('data.json?' + Date.now()); // å¼·åˆ¶é‡æ–°è¼‰å…¥
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            if (!data || !data.foodTrucks || !Array.isArray(data.foodTrucks)) {
                throw new Error('data.json æ ¼å¼ä¸æ­£ç¢º');
            }
            
            foodTruckDatabase = data.foodTrucks;
            
            // å„²å­˜åˆ°æœ¬åœ°
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));
            
            console.log(`ğŸŒ å¾ data.json è¼‰å…¥æœ€æ–°è³‡æ–™: ${foodTruckDatabase.length} å€‹é¤è»Š`);
            return { success: true, source: 'data.json', count: foodTruckDatabase.length };
        }
        
        // å¾æœ¬åœ°è¼‰å…¥è³‡æ–™
        async function loadFromLocal() {
            console.log('ğŸ“± å¾ localStorage è¼‰å…¥è³‡æ–™...');
            const localData = localStorage.getItem('foodTruckData');
            if (!localData) {
                throw new Error('localStorage ä¸­æ²’æœ‰è³‡æ–™');
            }
            
            const data = JSON.parse(localData);
            if (!data || !data.foodTrucks || !Array.isArray(data.foodTrucks) || data.foodTrucks.length === 0) {
                throw new Error('localStorage è³‡æ–™æ ¼å¼ä¸æ­£ç¢ºæˆ–ç‚ºç©º');
            }
            
            foodTruckDatabase = data.foodTrucks;
            console.log(`ğŸ“± å¾æœ¬åœ°å„²å­˜è¼‰å…¥è³‡æ–™: ${foodTruckDatabase.length} å€‹é¤è»Š`);
            return { success: true, source: 'localStorage', count: foodTruckDatabase.length };
        }
        
        // ä½¿ç”¨é è¨­è³‡æ–™
        async function loadFromDefault() {
            console.log('âš ï¸ ä½¿ç”¨é è¨­è³‡æ–™');
            if (!foodTruckDatabase || foodTruckDatabase.length === 0) {
                console.log('ğŸ”„ åˆå§‹åŒ–é è¨­é¤è»Šè³‡æ–™...');
                // foodTruckDatabase å·²ç¶“åœ¨è…³æœ¬é ‚éƒ¨å®šç¾©äº†é è¨­å€¼
            }
            
            showAlert('ä½¿ç”¨é è¨­é¤è»Šè³‡æ–™', 'warning');
            return { success: false, source: 'default', count: foodTruckDatabase.length, error: 'æ‰€æœ‰è¼‰å…¥æ–¹å¼éƒ½å¤±æ•—' };
        }

        // ç¨ç«‹çš„è³‡æ–™é©—è­‰å‡½æ•¸
        function validateData() {
            console.log('ğŸ” é©—è­‰è³‡æ–™å®Œæ•´æ€§...');
            
            // æª¢æŸ¥ foodTruckDatabase
            if (!foodTruckDatabase || !Array.isArray(foodTruckDatabase)) {
                console.log('âŒ foodTruckDatabase ä¸æ˜¯æœ‰æ•ˆé™£åˆ—');
                return false;
            }
            
            // æª¢æŸ¥æ¯å€‹é¤è»Šè³‡æ–™
            let validCount = 0;
            foodTruckDatabase.forEach((truck, index) => {
                if (truck && truck.id && truck.title && truck.src) {
                    validCount++;
                } else {
                    console.log(`âš ï¸ é¤è»Š ${index} è³‡æ–™ä¸å®Œæ•´:`, truck);
                }
            });
            
            console.log(`ğŸ“Š è³‡æ–™é©—è­‰çµæœ: ${validCount}/${foodTruckDatabase.length} å€‹æœ‰æ•ˆé¤è»Š`);
            return validCount > 0;
        }

        // ç·¨è¼¯ç‹€æ…‹ç®¡ç†å‡½æ•¸
        function saveEditingState() {
            console.log('ğŸ’¾ ä¿å­˜ç·¨è¼¯ç‹€æ…‹...');
            
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));
            
            console.log('âœ… ç·¨è¼¯ç‹€æ…‹å·²ä¿å­˜');
        }

        // ç¨ç«‹çš„è³‡æ–™ä¿®å¾©å‡½æ•¸
        function repairData() {
            console.log('ğŸ”§ é–‹å§‹ä¿®å¾©è³‡æ–™...');
            
            // 1. ä¿®å¾© foodTruckDatabase
            if (!foodTruckDatabase || !Array.isArray(foodTruckDatabase)) {
                console.log('ğŸ”§ ä¿®å¾© foodTruckDatabase é™£åˆ—');
                foodTruckDatabase = [];
            }
            
            // 2. ä¿®å¾©æ¯å€‹é¤è»Šè³‡æ–™
            foodTruckDatabase = foodTruckDatabase.filter(truck => {
                if (!truck || typeof truck !== 'object') return false;
                if (!truck.id || !truck.title || !truck.src) return false;
                return true;
            });
            
            // 3. é‡æ–°è¨­å®šå„ªå…ˆç´šå’Œé è¨­å€¼
            foodTruckDatabase.forEach((truck, index) => {
                truck.priority = index + 1;
                if (truck.isActive === undefined) truck.isActive = true;
                if (!truck.category) truck.category = 'main';
                // ä¿ç•™ç·¨è¼¯ç‹€æ…‹ï¼Œä¸è¦é‡ç½®
                // if (truck.isEditing === undefined) truck.isEditing = false;
            });
            
            console.log(`ğŸ”§ è³‡æ–™ä¿®å¾©å®Œæˆ: ${foodTruckDatabase.length} å€‹æœ‰æ•ˆé¤è»Š`);
            return foodTruckDatabase.length;
        }

        // ç¨ç«‹çš„åˆå§‹åŒ–å‡½æ•¸
        function initializeData() {
            console.log('ğŸ”„ åˆå§‹åŒ–è³‡æ–™ç‹€æ…‹...');
            
            // 1. é©—è­‰è³‡æ–™å®Œæ•´æ€§
            const isValid = validateData();
            
            // 2. å¦‚æœè³‡æ–™ç„¡æ•ˆï¼Œå˜—è©¦ä¿®å¾©
            if (!isValid) {
                console.log('ğŸ”§ è³‡æ–™ç„¡æ•ˆï¼Œé–‹å§‹ä¿®å¾©...');
                const repairedCount = repairData();
                console.log(`ğŸ”§ ä¿®å¾©å®Œæˆ: ${repairedCount} å€‹é¤è»Š`);
            }
            
            // 3. ç¢ºä¿ foodTruckDatabase æœ‰è³‡æ–™
            if (!foodTruckDatabase || foodTruckDatabase.length === 0) {
                console.log('âš ï¸ foodTruckDatabase ç‚ºç©ºï¼Œä½¿ç”¨é è¨­è³‡æ–™');
                // ä½¿ç”¨é è¨­è³‡æ–™ï¼ˆå·²åœ¨è…³æœ¬é ‚éƒ¨å®šç¾©ï¼‰
            }
            
            // 4. åˆå§‹åŒ– filteredTrucks
            filteredTrucks = [...foodTruckDatabase];
            
            // 5. ç¢ºä¿ selectedTrucks æ˜¯æœ‰æ•ˆçš„ Set
            if (!selectedTrucks || !(selectedTrucks instanceof Set)) {
                selectedTrucks = new Set();
            }
            
            console.log(`âœ… è³‡æ–™åˆå§‹åŒ–å®Œæˆ: ${foodTruckDatabase.length} å€‹é¤è»Š`);
            
            return {
                foodTruckCount: foodTruckDatabase.length,
                filteredCount: filteredTrucks.length,
                hasData: foodTruckDatabase.length > 0,
                isValid: isValid
            };
        }

        let isSaving = false;
        let lastSaveTime = 0;
        
        async function manualSaveData() {
            const now = Date.now();
            
            if (isSaving || now - lastSaveTime < 300) {
                console.log('âš ï¸ è·³éé‡è¤‡å„²å­˜');
                return;
            }
            
            isSaving = true;
            lastSaveTime = now;
            
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            
            // å„²å­˜åˆ°æœ¬åœ°
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));
            
            console.log('ğŸ’¾ è³‡æ–™å·²å„²å­˜åˆ°æœ¬åœ°');
            
            try {
                // æª¢æŸ¥ GitHub è¨­å®š
                const status = githubSync.getProjectStatus();
                
                if (!status.hasToken) {
                    const setupToken = confirm(
                        'éœ€è¦è¨­å®š GitHub Token æ‰èƒ½åŒæ­¥åˆ°é ç«¯\n\n' +
                        'æ˜¯å¦ç¾åœ¨è¨­å®šï¼Ÿ\n\n' +
                        'é»æ“Šã€Œç¢ºå®šã€è¨­å®š Token\n' +
                        'é»æ“Šã€Œå–æ¶ˆã€åƒ…å„²å­˜åˆ°æœ¬åœ°'
                    );
                    
                    if (setupToken) {
                        if (githubSync.showTokenDialog()) {
                            await validateAndSync(data);
                        } else {
                            showSyncStatus('âŒ æœªè¨­å®š Tokenï¼Œåƒ…å„²å­˜åˆ°æœ¬åœ°');
                        }
                    } else {
                        showSyncStatus('ğŸ’¾ å·²å„²å­˜åˆ°æœ¬åœ°ï¼ˆæœªåŒæ­¥åˆ°é ç«¯ï¼‰');
                    }
                } else {
                    await validateAndSync(data);
                }
            } catch (error) {
                console.error('åŒæ­¥å¤±æ•—:', error);
                showSyncStatus('âŒ åŒæ­¥å¤±æ•—ï¼Œä½†å·²å„²å­˜åˆ°æœ¬åœ°');
                // å‚™ç”¨æ–¹æ¡ˆï¼šä¸‹è¼‰æª”æ¡ˆ
                updateDataJsonAndPush(data);
            }
            
            setTimeout(() => {
                isSaving = false;
            }, 300);
        }

        async function validateAndSync(data) {
            try {
                // é©—è­‰ Token
                const validation = await githubSync.validateToken();
                
                if (!validation.valid) {
                    throw new Error(validation.message);
                }
                
                showSyncStatus('ğŸ”„ æ­£åœ¨åŒæ­¥åˆ° GitHub...');
                
                // åŒæ­¥åˆ° GitHub
                const result = await githubSync.syncData(data);
                
                showSyncStatus('âœ… è³‡æ–™å·²åŒæ­¥åˆ° GitHubï¼');
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                setTimeout(() => {
                    const message = `åŒæ­¥æˆåŠŸï¼\n\n` +
                        `ğŸ“ æäº¤è¨Šæ¯ï¼šè‡ªå‹•åŒæ­¥é¤è»Šè³‡æ–™\n` +
                        `ğŸ”— æŸ¥çœ‹æäº¤ï¼š${result.commitUrl}\n` +
                        `ğŸŒ ç¶²ç«™ï¼š${githubSync.currentProject.website}\n\n` +
                        `æ˜¯å¦è¦é–‹å•Ÿç¶²ç«™æŸ¥çœ‹æ›´æ–°ï¼Ÿ`;
                    
                    if (confirm(message)) {
                        window.open(githubSync.currentProject.website, '_blank');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('åŒæ­¥å¤±æ•—:', error);
                showSyncStatus(`âŒ åŒæ­¥å¤±æ•—ï¼š${error.message}`);
                
                // å‚™ç”¨æ–¹æ¡ˆï¼šä¸‹è¼‰æª”æ¡ˆ
                updateDataJsonAndPush(data);
            }
        }
        
        function autoSaveData() {
            console.log('ğŸ”„ è³‡æ–™å·²æ›´æ–°ï¼ˆæœªåŒæ­¥ï¼‰');
        }
        
        function updateDataJsonAndPush(data) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.json';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('ğŸ“¥ å·²è‡ªå‹•ä¸‹è¼‰æ›´æ–°å¾Œçš„ data.json');
            showSyncStatus('ğŸ“¥ å·²ä¸‹è¼‰ data.jsonï¼Œè«‹æ‰‹å‹•ä¸Šå‚³åˆ° GitHub');
            
            setTimeout(() => {
                const message = `è³‡æ–™å·²æ›´æ–°ï¼\n\nğŸ“¥ data.json å·²è‡ªå‹•ä¸‹è¼‰\n\nğŸ“„ è¦åŒæ­¥åˆ° GitHubï¼Œè«‹åŸ·è¡Œï¼š\n1. å°‡ä¸‹è¼‰çš„ data.json æ›¿æ›å°ˆæ¡ˆä¸­çš„æª”æ¡ˆ\n2. åŸ·è¡Œ "auto_github_sync.bat" è‡ªå‹•åŒæ­¥\n3. æˆ–æ‰‹å‹•åŸ·è¡Œ Git å‘½ä»¤\n\næ˜¯å¦è¦é–‹å•Ÿ GitHub é é¢ï¼Ÿ`;
                
                if (confirm(message)) {
                    window.open('https://github.com', '_blank');
                }
            }, 1000);
        }

        function showSyncStatus(message) {
            const syncStatus = document.getElementById('syncStatus');
            const syncMessage = document.getElementById('syncMessage');
            
            syncMessage.textContent = message;
            syncStatus.style.display = 'block';
            
            setTimeout(() => {
                syncStatus.style.display = 'none';
            }, 3000);
        }

        function saveFoodTruckData() {
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            autoSaveData();
            showAlert('è³‡æ–™å·²åŒ¯å‡ºç‚ºdata.jsonä¸¦å„²å­˜åˆ°æœ¬åœ°', 'success');
        }

        function updateStats() {
            const total = foodTruckDatabase.length;
            const active = foodTruckDatabase.filter(t => t.isActive).length;
            const inactive = total - active;
            
            // ç§»é™¤äº†çµ±è¨ˆå¡ç‰‡çš„æ›´æ–°ï¼Œå› ç‚ºå·²ç¶“åˆªé™¤äº†çµ±è¨ˆå€åŸŸ
            console.log(`çµ±è¨ˆæ›´æ–°: ç¸½æ•¸${total}, å·²ä¸Šæ¶${active}, å·²ä¸‹æ¶${inactive}`);
        }

        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alertMessage');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            // ç¢ºä¿ foodTruckDatabase æœ‰è³‡æ–™
            if (!foodTruckDatabase || foodTruckDatabase.length === 0) {
                console.log('âš ï¸ foodTruckDatabase ç‚ºç©ºï¼Œç„¡æ³•ç¯©é¸');
                filteredTrucks = [];
                renderTruckCards();
                updateStats();
                return;
            }

            filteredTrucks = foodTruckDatabase.filter(truck => {
                const matchesSearch = truck.title.toLowerCase().includes(searchTerm) || 
                                    truck.alt.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || 
                                    (statusFilter === 'active' && truck.isActive) ||
                                    (statusFilter === 'inactive' && !truck.isActive);
                return matchesSearch && matchesStatus;
            });

            filteredTrucks.sort((a, b) => {
                switch(sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'id':
                        return a.id.localeCompare(b.id);
                    case 'priority':
                    default:
                        return a.priority - b.priority;
                }
            });

            console.log(`ğŸ” ç¯©é¸çµæœ: ${filteredTrucks.length} å€‹é¤è»Š`);
            renderTruckCards();
            updateStats();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('sortBy').value = 'priority';
            
            // ç¢ºä¿ foodTruckDatabase æœ‰è³‡æ–™
            if (!foodTruckDatabase || foodTruckDatabase.length === 0) {
                console.log('âš ï¸ foodTruckDatabase ç‚ºç©ºï¼Œç„¡æ³•æ¸…é™¤ç¯©é¸');
                filteredTrucks = [];
            } else {
                filteredTrucks = [...foodTruckDatabase];
            }
            
            console.log(`ğŸ”„ æ¸…é™¤ç¯©é¸: ${filteredTrucks.length} å€‹é¤è»Š`);
            renderTruckCards();
            updateStats();
        }

        function showImageModal(src, alt, link = '') {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = src;
            modalImage.alt = alt;
            
            if (link) {
                modalImage.style.cursor = 'pointer';
                modalImage.onclick = function() {
                    window.open(link, '_blank');
                };
            } else {
                modalImage.style.cursor = 'default';
                modalImage.onclick = null;
            }
            
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function hideImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        function toggleTruckSelection(truckId) {
            if (selectedTrucks.has(truckId)) {
                selectedTrucks.delete(truckId);
            } else {
                selectedTrucks.add(truckId);
            }
            updateBatchActions();
            renderTruckCards();
        }

        function updateBatchActions() {
            const batchActions = document.getElementById('batchActions');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedTrucks.size > 0) {
                batchActions.classList.add('show');
                selectedCount.textContent = selectedTrucks.size;
            } else {
                batchActions.classList.remove('show');
            }
        }

        async function batchToggle(isActive) {
            if (selectedTrucks.size === 0) return;
            
            let count = 0;
            selectedTrucks.forEach(truckId => {
                const truck = foodTruckDatabase.find(t => t.id === truckId);
                if (truck) {
                    truck.isActive = isActive;
                    count++;
                }
            });
            
            // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));
            
            showAlert(`å·²${isActive ? 'ä¸Šæ¶' : 'ä¸‹æ¶'} ${count} å€‹é¤è»Š`, 'success');
            clearSelection();
            applyFilters();
            
            // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
            try {
                const status = githubSync.getProjectStatus();
                if (status.hasToken) {
                    console.log('ğŸ”„ è‡ªå‹•åŒæ­¥æ‰¹é‡ç‹€æ…‹è®Šæ›´åˆ°é ç«¯...');
                    await manualSaveData();
                }
            } catch (error) {
                console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
            }
        }

        function clearSelection() {
            selectedTrucks.clear();
            updateBatchActions();
            renderTruckCards();
        }

        async function batchDelete() {
            if (selectedTrucks.size === 0) return;
            
            const confirmDelete = confirm(`ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ${selectedTrucks.size} å€‹é¤è»Šå—ï¼Ÿ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`);
            if (confirmDelete) {
                let count = 0;
                const truckIdsToDelete = Array.from(selectedTrucks);
                
                truckIdsToDelete.forEach(truckId => {
                    const index = foodTruckDatabase.findIndex(t => t.id === truckId);
                    if (index > -1) {
                        foodTruckDatabase.splice(index, 1);
                        count++;
                    }
                });
                
                foodTruckDatabase.forEach((t, idx) => {
                    t.priority = idx + 1;
                });
                
                // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
                const data = {
                    foodTrucks: foodTruckDatabase,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('foodTruckData', JSON.stringify(data));
                sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                
                showAlert(`å·²åˆªé™¤ ${count} å€‹é¤è»Š`, 'success');
                clearSelection();
                applyFilters();
                renderPreview();
                
                // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                try {
                    const status = githubSync.getProjectStatus();
                    if (status.hasToken) {
                        console.log('ğŸ”„ è‡ªå‹•åŒæ­¥æ‰¹é‡åˆªé™¤åˆ°é ç«¯...');
                        await manualSaveData();
                    }
                } catch (error) {
                    console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
                }
            }
        }

        async function deleteTruck(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (truck) {
                const confirmDelete = confirm(`ç¢ºå®šè¦åˆªé™¤é¤è»Š "${truck.title}" å—ï¼Ÿ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`);
                if (confirmDelete) {
                    const index = foodTruckDatabase.findIndex(t => t.id === truckId);
                    if (index > -1) {
                        foodTruckDatabase.splice(index, 1);
                        
                        foodTruckDatabase.forEach((t, idx) => {
                            t.priority = idx + 1;
                        });
                        
                        // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
                        const data = {
                            foodTrucks: foodTruckDatabase,
                            lastUpdated: new Date().toISOString()
                        };
                        localStorage.setItem('foodTruckData', JSON.stringify(data));
                        sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                        
                        showAlert(`é¤è»Š "${truck.title}" å·²åˆªé™¤`, 'success');
                        updateStats();
                        applyFilters();
                        renderPreview();
                        
                        // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                        try {
                            const status = githubSync.getProjectStatus();
                            if (status.hasToken) {
                                console.log('ğŸ”„ è‡ªå‹•åŒæ­¥åˆªé™¤åˆ°é ç«¯...');
                                await manualSaveData();
                            }
                        } catch (error) {
                            console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
                        }
                    }
                }
            }
        }

        function renderTruckCards() {
            const grid = document.getElementById('truckGrid');
            if (!grid) {
                console.error('âŒ æ‰¾ä¸åˆ° truckGrid å…ƒç´ ');
                return;
            }
            
            grid.innerHTML = '';
            
            // ç¢ºä¿ foodTruckDatabase æœ‰è³‡æ–™
            if (!foodTruckDatabase || foodTruckDatabase.length === 0) {
                console.log('âš ï¸ foodTruckDatabase ç‚ºç©ºï¼Œé¡¯ç¤ºç©ºç‹€æ…‹');
                grid.innerHTML = '<div style="text-align: center; padding: 2rem; color: #64748b;">æš«ç„¡é¤è»Šè³‡æ–™</div>';
                return;
            }
            
            // ç¢ºä¿ filteredTrucks æœ‰è³‡æ–™
            if (!filteredTrucks || filteredTrucks.length === 0) {
                console.log('âš ï¸ filteredTrucks ç‚ºç©ºï¼Œé‡æ–°åˆå§‹åŒ–');
                filteredTrucks = [...foodTruckDatabase];
            }
            
            console.log(`ğŸ–¼ï¸ æ¸²æŸ“ ${filteredTrucks.length} å€‹é¤è»Šå¡ç‰‡ (ç¸½å…± ${foodTruckDatabase.length} å€‹)`);
            
            filteredTrucks.forEach(truck => {
                const isSelected = selectedTrucks.has(truck.id);
                const isEditing = truck.isEditing || false;
                const card = document.createElement('div');
                card.className = `truck-card ${truck.isActive ? 'active' : 'inactive'} ${isSelected ? 'selected' : ''} ${isEditing ? 'editing' : ''}`;
                
                let linkButtons = '';
                let editLinksHTML = '';
                
                if (isEditing) {
                    // ç·¨è¼¯æ¨¡å¼çš„é€£çµè¼¸å…¥
                    const links = Array.isArray(truck.link) ? truck.link : [];
                    editLinksHTML = `
                        <div class="edit-links-container">
                            ${[1,2,3].map(i => {
                                const link = links[i-1] || { text: '', url: '' };
                                return `
                                    <div class="edit-link-group">
                                        <div>
                                            <div class="edit-link-label">æŒ‰éˆ•${i}</div>
                                            <input type="text" class="truck-link-input" 
                                                   id="edit-text-${truck.id}-${i}" 
                                                   value="${link.text || ''}" 
                                                   placeholder="æ–‡å­—" maxlength="10">
                                        </div>
                                        <div>
                                            <div class="edit-link-label">ç¶²å€${i}</div>
                                            <input type="url" class="truck-link-input" 
                                                   id="edit-url-${truck.id}-${i}" 
                                                   value="${link.url || ''}" 
                                                   placeholder="https://...">
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    // é¡¯ç¤ºæ¨¡å¼çš„é€£çµæŒ‰éˆ•
                    if (truck.link && Array.isArray(truck.link)) {
                        linkButtons = truck.link.map(link => 
                            `<a href="${link.url}" target="_blank" class="truck-link-btn">${link.text}</a>`
                        ).join('');
                    }
                }
                
                card.innerHTML = `
                    <div class="truck-image-container">
                        <div class="truck-priority-badge">#${truck.priority}</div>
                        <input type="checkbox" class="truck-checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="toggleTruckSelection('${truck.id}')">
                        <img src="${truck.src}" alt="${truck.alt}" class="truck-image" 
                             onclick="showImageModal('${truck.src}', '${truck.alt}', '${truck.imgLink || ''}')"
                             onerror="this.src='https://via.placeholder.com/200x120/e2e8f0/64748b?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—'">
                        <div class="move-buttons">
                            <button class="move-btn" onclick="moveTruck('${truck.id}', 'up')" title="ä¸Šç§»">â†‘</button>
                            <button class="move-btn" onclick="moveTruck('${truck.id}', 'down')" title="ä¸‹ç§»">â†“</button>
                        </div>
                    </div>
                    
                    <div class="truck-info">
                        ${isEditing ? `
                            <input type="text" class="truck-title-input" 
                                   id="edit-title-${truck.id}" 
                                   value="${truck.title}" placeholder="é¤è»Šåç¨±">
                            <textarea class="truck-alt-input" 
                                      id="edit-alt-${truck.id}" 
                                      placeholder="åœ–ç‰‡æè¿°">${truck.alt}</textarea>
                            ${editLinksHTML}
                        ` : `
                            <div class="truck-title" onclick="editTitle('${truck.id}')" title="é»æ“Šç·¨è¼¯">${truck.title}</div>
                            <div class="truck-alt">${truck.alt}</div>
                            ${linkButtons ? `<div class="truck-links">${linkButtons}</div>` : ''}
                        `}
                        
                        <div class="truck-actions">
                            <div>
                                <span class="status-badge status-${truck.isActive ? 'active' : 'inactive'}">
                                    ${truck.isActive ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}
                                </span>
                            </div>
                            <div style="display: flex; gap: 0.25rem;">
                                ${truck.isActive ? 
                                    `<button class="btn btn-danger btn-sm" onclick="toggleTruck('${truck.id}')">ä¸‹æ¶</button>` :
                                    `<button class="btn btn-success btn-sm" onclick="toggleTruck('${truck.id}')">ä¸Šæ¶</button>`
                                }
                                ${isEditing ? 
                                    `<button class="btn btn-success btn-sm" onclick="saveTruckEdit('${truck.id}')">å„²å­˜</button>
                                     <button class="btn btn-secondary btn-sm" onclick="cancelTruckEdit('${truck.id}')">å–æ¶ˆ</button>` :
                                    `<button class="btn btn-warning btn-sm" onclick="startTruckEdit('${truck.id}')">ç·¨è¼¯</button>`
                                }
                                <button class="btn btn-danger btn-sm" onclick="deleteTruck('${truck.id}')">åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // é–‹å§‹ç·¨è¼¯æ¨¡å¼
        function startTruckEdit(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (truck) {
                truck.isEditing = true;
                saveEditingState();
                renderTruckCards();
                console.log(`âœï¸ é–‹å§‹ç·¨è¼¯é¤è»Š: ${truck.title}`);
            }
        }

        // å„²å­˜ç·¨è¼¯
        async function saveTruckEdit(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (!truck) return;

            // ç²å–ç·¨è¼¯å¾Œçš„å€¼
            const newTitle = document.getElementById(`edit-title-${truckId}`).value.trim();
            const newAlt = document.getElementById(`edit-alt-${truckId}`).value.trim();
            
            if (!newTitle) {
                alert('é¤è»Šåç¨±ä¸èƒ½ç‚ºç©ºï¼');
                return;
            }

            // æ›´æ–°åŸºæœ¬è³‡è¨Š
            truck.title = newTitle;
            truck.alt = newAlt || newTitle;

            // æ›´æ–°é€£çµ
            const linkData = [];
            for (let i = 1; i <= 3; i++) {
                const textInput = document.getElementById(`edit-text-${truckId}-${i}`);
                const urlInput = document.getElementById(`edit-url-${truckId}-${i}`);
                
                if (textInput && urlInput) {
                    const text = textInput.value.trim();
                    const url = urlInput.value.trim();
                    
                    if (text && url) {
                        linkData.push({ text, url });
                    }
                }
            }
            
            truck.link = linkData.length > 0 ? linkData : '';
            truck.isEditing = false;

            // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));

            showAlert(`é¤è»Š "${truck.title}" å·²æ›´æ–°ä¸¦å„²å­˜`, 'success');
            renderTruckCards();
            renderPreview();
            
            // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
            try {
                const status = githubSync.getProjectStatus();
                if (status.hasToken) {
                    console.log('ğŸ”„ è‡ªå‹•åŒæ­¥ç·¨è¼¯è®Šæ›´åˆ°é ç«¯...');
                    await manualSaveData();
                }
            } catch (error) {
                console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
            }
        }

        // å–æ¶ˆç·¨è¼¯
        function cancelTruckEdit(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (truck) {
                truck.isEditing = false;
                saveEditingState();
                renderTruckCards();
                console.log(`âŒ å–æ¶ˆç·¨è¼¯é¤è»Š: ${truck.title}`);
            }
        }

        // ç°¡åŒ–åŸæœ‰çš„ç·¨è¼¯å‡½æ•¸
        function editTruck(truckId) {
            startTruckEdit(truckId);
        }

        function renderPreview() {
            const preview = document.getElementById('marqueePreview');
            const activeTrucks = foodTruckDatabase.filter(t => t.isActive).sort((a, b) => a.priority - b.priority);
            
            preview.innerHTML = '';
            
            if (activeTrucks.length === 0) {
                console.log('ğŸ–¼ï¸ æ²’æœ‰æ´»èºçš„é¤è»Šï¼Œé è¦½ç‚ºç©º');
                return;
            }
            
            activeTrucks.forEach(truck => {
                const item = document.createElement('div');
                item.className = 'marquee-item-preview';
                item.innerHTML = `<img src="${truck.src}" alt="${truck.alt}" onerror="this.src='https://via.placeholder.com/80x60/cccccc/666666?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—'">`;
                preview.appendChild(item);
            });
            
            console.log(`ğŸ–¼ï¸ é è¦½å·²æ›´æ–°ï¼Œé¡¯ç¤º ${activeTrucks.length} å€‹é¤è»Š`);
        }

        async function toggleTruck(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (truck) {
                truck.isActive = !truck.isActive;
                
                // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
                const data = {
                    foodTrucks: foodTruckDatabase,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('foodTruckData', JSON.stringify(data));
                sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                
                showAlert(`é¤è»Š "${truck.title}" å·²${truck.isActive ? 'ä¸Šæ¶' : 'ä¸‹æ¶'}`, 'success');
                updateStats();
                applyFilters();
                renderPreview();
                
                // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                try {
                    const status = githubSync.getProjectStatus();
                    if (status.hasToken) {
                        console.log('ğŸ”„ è‡ªå‹•åŒæ­¥ç‹€æ…‹è®Šæ›´åˆ°é ç«¯...');
                        await manualSaveData();
                    }
                } catch (error) {
                    console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
                }
            }
        }

        async function editTitle(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (!truck) return;
            
            const newTitle = prompt('è«‹è¼¸å…¥é¤è»Šåç¨±:', truck.title || '');
            if (newTitle !== null && newTitle.trim() !== '') {
                truck.title = newTitle.trim();
                
                // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
                const data = {
                    foodTrucks: foodTruckDatabase,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('foodTruckData', JSON.stringify(data));
                sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                
                showAlert('é¤è»Šåç¨±å·²æ›´æ–°ä¸¦å„²å­˜', 'success');
                applyFilters();
                
                // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                try {
                    const status = githubSync.getProjectStatus();
                    if (status.hasToken) {
                        console.log('ğŸ”„ è‡ªå‹•åŒæ­¥æ¨™é¡Œè®Šæ›´åˆ°é ç«¯...');
                        await manualSaveData();
                    }
                } catch (error) {
                    console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
                }
            }
        }

        function editTruck(truckId) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (!truck) return;
            
            const newSrc = prompt('è«‹è¼¸å…¥åœ–ç‰‡ç¶²å€:', truck.src || '');
            if (newSrc !== null && newSrc.trim() !== '') {
                truck.src = newSrc.trim();
                
                const newAlt = prompt('è«‹è¼¸å…¥æ›¿ä»£æ–‡å­—:', truck.alt || '');
                if (newAlt !== null) {
                    truck.alt = newAlt.trim() || truck.title;
                }
                
                const newImgLink = prompt('è«‹è¼¸å…¥åœ–ç‰‡è¶…é€£çµ (é¸å¡«):', truck.imgLink || '');
                if (newImgLink !== null) {
                    truck.imgLink = newImgLink.trim();
                }
                
                showAlert('é¤è»Šè³‡è¨Šå·²æ›´æ–°', 'success');
                applyFilters();
                renderPreview();
            }
        }

        async function moveTruck(truckId, direction) {
            const truck = foodTruckDatabase.find(t => t.id === truckId);
            if (truck) {
                const currentIndex = foodTruckDatabase.findIndex(t => t.id === truckId);
                const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                
                if (newIndex >= 0 && newIndex < foodTruckDatabase.length) {
                    [foodTruckDatabase[currentIndex], foodTruckDatabase[newIndex]] = 
                    [foodTruckDatabase[newIndex], foodTruckDatabase[currentIndex]];
                    
                    foodTruckDatabase.forEach((t, index) => {
                        t.priority = index + 1;
                    });
                    
                    // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
                    const data = {
                        foodTrucks: foodTruckDatabase,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('foodTruckData', JSON.stringify(data));
                    sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                    
                    showAlert(`é¤è»Š "${truck.title}" å·²${direction === 'up' ? 'ä¸Šç§»' : 'ä¸‹ç§»'}`, 'success');
                    applyFilters();
                    renderPreview();
                    
                    // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
                    try {
                        const status = githubSync.getProjectStatus();
                        if (status.hasToken) {
                            console.log('ğŸ”„ è‡ªå‹•åŒæ­¥æ’åºè®Šæ›´åˆ°é ç«¯...');
                            await manualSaveData();
                        }
                    } catch (error) {
                        console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
                    }
                }
            }
        }

        function fillExample(text, url) {
            for (let i = 1; i <= 3; i++) {
                const textInput = document.getElementById(`newTruckText${i}`);
                const urlInput = document.getElementById(`newTruckLink${i}`);
                
                if (!textInput.value && !urlInput.value) {
                    textInput.value = text;
                    urlInput.value = url;
                    
                    textInput.style.background = 'rgba(16, 185, 129, 0.1)';
                    urlInput.style.background = 'rgba(16, 185, 129, 0.1)';
                    
                    setTimeout(() => {
                        textInput.style.background = '';
                        urlInput.style.background = '';
                    }, 1000);
                    
                    showAlert(`å·²å¡«å…¥ç¯„ä¾‹ï¼š${text}`, 'success');
                    break;
                }
            }
        }

        function openPostimageUpload() {
            window.open('https://postimages.org/', '_blank');
            showAlert('å·²é–‹å•Ÿ Postimage ä¸Šå‚³é é¢', 'success');
        }

        // è¨­å®š GitHub Token
        function setupGitHubToken() {
            // ç›´æ¥è¨­å®šæä¾›çš„ Token
            const token = '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';
            projectConfig.setGitHubToken(token);
            showAlert('âœ… GitHub Token å·²è¨­å®šï¼åŒæ­¥åŠŸèƒ½å·²å•Ÿç”¨', 'success');
            
            // æ¸¬è©¦ Token æ˜¯å¦æœ‰æ•ˆ
            testGitHubToken();
        }
        
        // æ¸¬è©¦ GitHub Token
        async function testGitHubToken() {
            try {
                showSyncStatus('ğŸ”„ æ­£åœ¨æ¸¬è©¦ GitHub Token...');
                
                const validation = await githubSync.validateToken();
                
                if (validation.valid) {
                    showSyncStatus('âœ… GitHub Token é©—è­‰æˆåŠŸï¼');
                    console.log('âœ… GitHub Token æœ‰æ•ˆï¼Œä½¿ç”¨è€…:', validation.user?.login);
                } else {
                    showSyncStatus('âŒ GitHub Token é©—è­‰å¤±æ•—');
                    console.error('âŒ GitHub Token ç„¡æ•ˆ:', validation.message);
                }
            } catch (error) {
                console.error('âŒ Token æ¸¬è©¦å¤±æ•—:', error);
                showSyncStatus('âŒ Token æ¸¬è©¦å¤±æ•—');
            }
        }
        
        // é–‹å•Ÿ Token è¨­å®šé é¢
        function openTokenSetup() {
            window.open('setup-github-token.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }

        // æª¢æŸ¥é ç«¯æ›´æ–°
        async function checkForUpdates() {
            try {
                showSyncStatus('ğŸ”„ æ­£åœ¨æª¢æŸ¥é ç«¯æ›´æ–°...');
                
                const status = githubSync.getProjectStatus();
                if (!status.hasToken) {
                    showAlert('è«‹å…ˆè¨­å®š GitHub Token', 'danger');
                    return;
                }

                const updateInfo = await githubSync.checkForUpdates('data.json');
                
                if (updateInfo.hasUpdate) {
                    const shouldUpdate = confirm(
                        `ç™¼ç¾é ç«¯æ›´æ–°ï¼\n\n` +
                        `é ç«¯ SHA: ${updateInfo.remoteSha.substring(0, 8)}...\n` +
                        `æœ¬åœ° SHA: ${updateInfo.localSha ? updateInfo.localSha.substring(0, 8) + '...' : 'ç„¡'}\n` +
                        `æ›´æ–°æ™‚é–“: ${new Date(updateInfo.lastModified).toLocaleString('zh-TW')}\n\n` +
                        `æ˜¯å¦è¦ä¸‹è¼‰é ç«¯æ›´æ–°ï¼Ÿ`
                    );
                    
                    if (shouldUpdate) {
                        await pullRemoteData();
                    }
                } else {
                    showSyncStatus('âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬');
                }
            } catch (error) {
                console.error('æª¢æŸ¥æ›´æ–°å¤±æ•—:', error);
                showAlert(`æª¢æŸ¥æ›´æ–°å¤±æ•—ï¼š${error.message}`, 'danger');
            }
        }

        // å¾é ç«¯æ‹‰å–è³‡æ–™
        async function pullRemoteData() {
            try {
                showSyncStatus('ğŸ”„ æ­£åœ¨ä¸‹è¼‰é ç«¯è³‡æ–™...');
                
                const result = await githubSync.pullData('data.json');
                const data = JSON.parse(result.content);
                
                // æ›´æ–°æœ¬åœ°è³‡æ–™
                foodTruckDatabase = data.foodTrucks;
                filteredTrucks = [...foodTruckDatabase];
                
                // å„²å­˜åˆ°æœ¬åœ°
                localStorage.setItem('foodTruckData', JSON.stringify(data));
                sessionStorage.setItem('foodTruckData', JSON.stringify(data));
                
                showAlert('å·²å¾é ç«¯æ›´æ–°è³‡æ–™', 'success');
                applyFilters();
                renderPreview();
                showSyncStatus('âœ… é ç«¯è³‡æ–™å·²åŒæ­¥');
                
            } catch (error) {
                console.error('æ‹‰å–é ç«¯è³‡æ–™å¤±æ•—:', error);
                showAlert(`æ‹‰å–é ç«¯è³‡æ–™å¤±æ•—ï¼š${error.message}`, 'danger');
            }
        }

        // èª¿è©¦å‡½æ•¸ï¼šæª¢æŸ¥è³‡æ–™ç‹€æ…‹
        function debugDataStatus() {
            console.log('ğŸ” è³‡æ–™ç‹€æ…‹æª¢æŸ¥:');
            console.log(`  foodTruckDatabase: ${foodTruckDatabase ? foodTruckDatabase.length : 'undefined'} å€‹é¤è»Š`);
            console.log(`  filteredTrucks: ${filteredTrucks ? filteredTrucks.length : 'undefined'} å€‹é¤è»Š`);
            console.log(`  selectedTrucks: ${selectedTrucks ? selectedTrucks.size : 'undefined'} å€‹é¸ä¸­`);
            
            if (foodTruckDatabase && foodTruckDatabase.length > 0) {
                console.log('  é¤è»Šåˆ—è¡¨:');
                foodTruckDatabase.forEach((truck, index) => {
                    console.log(`    ${index + 1}. ${truck.title} (${truck.isActive ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'})`);
                });
            }
            
            // é¡¯ç¤ºåœ¨é é¢ä¸Š
            const status = `è³‡æ–™ç‹€æ…‹: ç¸½å…± ${foodTruckDatabase ? foodTruckDatabase.length : 0} å€‹é¤è»Š, ç¯©é¸å¾Œ ${filteredTrucks ? filteredTrucks.length : 0} å€‹é¤è»Š`;
            showAlert(status, 'info');
        }

        // å¼·åˆ¶é‡æ–°è¼‰å…¥è³‡æ–™
        async function forceReloadData() {
            console.log('ğŸ”„ å¼·åˆ¶é‡æ–°è¼‰å…¥è³‡æ–™...');
            
            try {
                // 1. æ¸…é™¤å¿«å–
                localStorage.removeItem('foodTruckData');
                sessionStorage.removeItem('foodTruckData');
                console.log('ğŸ—‘ï¸ å·²æ¸…é™¤æœ¬åœ°å¿«å–');
                
                // 2. å¼·åˆ¶å¾é ç«¯è¼‰å…¥è³‡æ–™
                const result = await loadFoodTruckData(true); // å¼·åˆ¶é ç«¯è¼‰å…¥
                console.log(`ğŸ“Š è¼‰å…¥çµæœ:`, result);
                
                // 3. ç¨ç«‹åˆå§‹åŒ–è³‡æ–™
                const initResult = initializeData();
                console.log(`ğŸ”§ åˆå§‹åŒ–çµæœ:`, initResult);
                
                // 4. å¼·åˆ¶é‡æ–°æ¸²æŸ“
                updateStats();
                applyFilters();
                renderPreview();
                
                // 5. é¡¯ç¤ºçµæœ
                if (initResult.hasData) {
                    showAlert(`âœ… è³‡æ–™å·²é‡æ–°è¼‰å…¥: ${initResult.foodTruckCount} å€‹é¤è»Š`, 'success');
                } else {
                    showAlert('âš ï¸ è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é è¨­è³‡æ–™', 'warning');
                }
                
            } catch (error) {
                console.error('âŒ é‡æ–°è¼‰å…¥å¤±æ•—:', error);
                
                // å³ä½¿å¤±æ•—ä¹Ÿè¦ç¢ºä¿æœ‰è³‡æ–™é¡¯ç¤º
                const initResult = initializeData();
                updateStats();
                applyFilters();
                renderPreview();
                
                showAlert(`âŒ é‡æ–°è¼‰å…¥å¤±æ•—: ${error.message}ï¼Œä½¿ç”¨é è¨­è³‡æ–™`, 'danger');
            }
        }


        document.getElementById('addTruckForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('newTruckTitle').value;
            const src = document.getElementById('newTruckSrc').value;
            const alt = document.getElementById('newTruckAlt').value || title;
            const imgLink = document.getElementById('newTruckImgLink').value.trim();
            
            const link1 = document.getElementById('newTruckLink1').value.trim();
            const link2 = document.getElementById('newTruckLink2').value.trim();
            const link3 = document.getElementById('newTruckLink3').value.trim();
            
            const text1 = document.getElementById('newTruckText1').value.trim() || 'å®˜ç¶²';
            const text2 = document.getElementById('newTruckText2').value.trim() || 'FB';
            const text3 = document.getElementById('newTruckText3').value.trim() || 'IG';
            
            const linkData = [];
            if (link1) linkData.push({ url: link1, text: text1 });
            if (link2) linkData.push({ url: link2, text: text2 });
            if (link3) linkData.push({ url: link3, text: text3 });
            
            const newTruck = {
                id: `truck_${Date.now()}`,
                src: src,
                alt: alt,
                title: title,
                imgLink: imgLink || '',
                link: linkData.length > 0 ? linkData : '',
                isActive: true,
                priority: foodTruckDatabase.length + 1,
                category: 'main'
            };
            
            foodTruckDatabase.push(newTruck);
            
            // å³æ™‚æ›´æ–°æœ¬åœ°å„²å­˜
            const data = {
                foodTrucks: foodTruckDatabase,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('foodTruckData', JSON.stringify(data));
            sessionStorage.setItem('foodTruckData', JSON.stringify(data));
            
            showAlert(`é¤è»Š "${title}" å·²æ–°å¢ä¸¦å„²å­˜`, 'success');
            
            document.getElementById('addTruckForm').reset();
            
            updateStats();
            applyFilters();
            renderPreview();
            
            // è‡ªå‹•åŒæ­¥åˆ°é ç«¯ï¼ˆå¦‚æœå·²è¨­å®š Tokenï¼‰
            try {
                const status = githubSync.getProjectStatus();
                if (status.hasToken) {
                    console.log('ğŸ”„ è‡ªå‹•åŒæ­¥æ–°å¢é¤è»Šåˆ°é ç«¯...');
                    await manualSaveData();
                }
            } catch (error) {
                console.log('âš ï¸ è‡ªå‹•åŒæ­¥å¤±æ•—ï¼Œä½†æœ¬åœ°å·²å„²å­˜');
            }
        });

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            
            try {
                // 1. åˆå§‹åŒ–å°ˆæ¡ˆè¨­å®š
                projectConfig.initialize();
                console.log('âœ… å°ˆæ¡ˆè¨­å®šå·²åˆå§‹åŒ–');
                
                // 1.5. è‡ªå‹•è¨­å®š GitHub Token
                const token = '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';
                projectConfig.setGitHubToken(token);
                console.log('âœ… GitHub Token å·²è‡ªå‹•è¨­å®š');
                
                // 2. è¼‰å…¥é¤è»Šè³‡æ–™
                const loadResult = await loadFoodTruckData();
                console.log('ğŸ“Š è³‡æ–™è¼‰å…¥çµæœ:', loadResult);
                
                // 3. ç¨ç«‹åˆå§‹åŒ–è³‡æ–™ç‹€æ…‹
                const initResult = initializeData();
                console.log('ğŸ”§ è³‡æ–™åˆå§‹åŒ–çµæœ:', initResult);
                
                // 4. æ¸²æŸ“ä»‹é¢
                console.log(`ğŸ–¼ï¸ é–‹å§‹æ¸²æŸ“ä»‹é¢: ${initResult.foodTruckCount} å€‹é¤è»Š`);
                updateStats();
                applyFilters();
                renderPreview();
                
                // 5. é¡¯ç¤ºè¼‰å…¥çµæœ
                if (initResult.hasData) {
                    console.log(`âœ… åˆå§‹åŒ–å®Œæˆ: ${initResult.foodTruckCount} å€‹é¤è»Šå·²è¼‰å…¥`);
                } else {
                    console.log('âš ï¸ åˆå§‹åŒ–å®Œæˆ: ä½¿ç”¨é è¨­è³‡æ–™');
                }
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±æ•—:', error);
                
                // å³ä½¿åˆå§‹åŒ–å¤±æ•—ï¼Œä¹Ÿè¦ç¢ºä¿æœ‰åŸºæœ¬åŠŸèƒ½
                const initResult = initializeData();
                updateStats();
                applyFilters();
                renderPreview();
                
                showAlert('åˆå§‹åŒ–å¤±æ•—ï¼Œä½¿ç”¨é è¨­è³‡æ–™', 'warning');
            }
            
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applyFilters);
            
            document.querySelectorAll('.example-item').forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                });
            });
            
            document.addEventListener('keydown', function(e) {
                // å¦‚æœç„¦é»åœ¨ç·¨è¼¯æ¨¡å¼çš„è¼¸å…¥æ¡†å…§ï¼Œå„ªå…ˆè™•ç†è¼¸å…¥æ¡†çš„ Ctrl+A
                if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                        e.preventDefault();
                        e.target.select();
                        return;
                    }
                }
                
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'a':
                            e.preventDefault();
                            if (selectedTrucks.size === filteredTrucks.length) {
                                clearSelection();
                            } else {
                                filteredTrucks.forEach(truck => selectedTrucks.add(truck.id));
                                updateBatchActions();
                                renderTruckCards();
                            }
                            break;
                        case 's':
                            e.preventDefault();
                            manualSaveData();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    hideImageModal();
                    clearSelection();
                }
            });
        });
    </script>
</body>
</html>
</html>