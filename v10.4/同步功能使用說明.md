# 🚀 餐車管理系統 - 同步功能使用說明

## 📋 功能概述

現在「儲存並同步」按鈕已經真正連接到更新系統！系統提供完整的 GitHub 同步功能，讓資料能夠即時更新到遠端並同步到前端。

## 🔧 設定步驟

### 1. 設定 GitHub Token

1. 前往 [GitHub Settings > Personal Access Tokens](https://github.com/settings/tokens)
2. 點擊 "Generate new token (classic)"
3. 選擇 "repo" 權限（完整倉庫存取權限）
4. 複製生成的 Token
5. 在管理後台點擊「🔑 設定 Token」按鈕
6. 貼上 Token 並確認

### 2. 確認專案設定

系統會自動載入預設專案設定：
- **專案名稱**: 餐開月行程表
- **GitHub 倉庫**: sky770825/niceshow
- **網站**: https://sky770825.github.io/niceshow

## 🎯 主要功能

### 管理後台 (admin.html)

#### 💾 儲存並同步
- **功能**: 將資料同步到 GitHub 並更新前端
- **流程**: 本地儲存 → GitHub 上傳 → 前端自動更新
- **特色**: 真正的即時同步，無需手動操作

#### 🔄 檢查更新
- **功能**: 檢查遠端是否有新資料
- **顯示**: 遠端 SHA、本地 SHA、更新時間
- **操作**: 可選擇是否下載遠端更新

#### 🔑 設定 Token
- **功能**: 設定或更換 GitHub Token
- **安全**: Token 僅儲存在本地瀏覽器

### 前端 (index.html)

#### 🆕 自動更新通知
- **觸發**: 背景檢查發現遠端更新
- **顯示**: 右上角通知卡片
- **選項**: 立即更新 或 稍後處理
- **自動**: 5秒後自動隱藏

#### 🔄 背景同步檢查
- **頻率**: 每次載入頁面時檢查
- **方式**: 比較遠端和本地 SHA
- **靜默**: 不影響使用者體驗

## 📊 同步流程圖

```
管理後台編輯
    ↓
點擊「儲存並同步」
    ↓
驗證 GitHub Token
    ↓
上傳到 GitHub 倉庫
    ↓
更新 data.json 檔案
    ↓
前端自動檢查更新
    ↓
顯示更新通知
    ↓
使用者確認更新
    ↓
重新載入頁面
    ↓
顯示最新資料
```

## 🛠️ 技術細節

### GitHub API 整合
- 使用 GitHub REST API v3
- 支援檔案上傳和下載
- 自動處理 SHA 衝突
- 錯誤處理和重試機制

### 資料同步機制
- 本地優先載入策略
- SHA 比較檢查更新
- 自動背景同步檢查
- 使用者友好的更新通知

### 安全性考量
- Token 僅儲存在本地
- 不儲存敏感資訊
- 支援 Token 更換
- 錯誤訊息不洩露敏感資訊

## 🚨 故障排除

### 同步失敗
1. 檢查 GitHub Token 是否有效
2. 確認網路連線正常
3. 檢查倉庫權限設定
4. 查看瀏覽器控制台錯誤訊息

### 更新通知不顯示
1. 確認已載入 GitHub 同步模組
2. 檢查專案設定是否正確
3. 確認遠端確實有更新

### Token 設定問題
1. 確認 Token 有 "repo" 權限
2. 檢查 Token 是否過期
3. 重新生成並設定新 Token

## 📈 效能優化

- **防抖動**: 避免重複同步請求
- **快取機制**: 本地資料優先載入
- **背景檢查**: 不影響主要功能
- **錯誤處理**: 優雅的失敗處理

## 🔮 未來規劃

- [ ] 支援多專案切換
- [ ] 自動同步排程
- [ ] 同步歷史記錄
- [ ] 衝突解決機制
- [ ] 離線編輯支援

---

## 💡 使用提示

1. **首次使用**: 務必先設定 GitHub Token
2. **定期同步**: 建議每次編輯後都點擊「儲存並同步」
3. **檢查更新**: 多人協作時定期檢查遠端更新
4. **備份資料**: 重要資料建議定期匯出備份

現在你的餐車管理系統已經具備完整的同步功能了！🎉
