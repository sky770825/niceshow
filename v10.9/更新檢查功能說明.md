# 🔄 更新檢查功能說明

## 📋 功能概述

更新檢查功能會自動監控遠端 GitHub 倉庫的 `data.json` 檔案，當發現有新版本時會通知使用者，並提供一鍵更新功能。

## 🚀 自動設定

### 1. Token 自動設定
- **檔案**: `auto-setup-token.js`
- **功能**: 自動設定 GitHub Token，無需手動輸入
- **預設 Token**: 已內建預設 Token（請替換為您的實際 Token）

### 2. 更新檢查器
- **檔案**: `update-checker.js`
- **功能**: 智能更新檢查和通知
- **檢查間隔**: 每 5 分鐘自動檢查一次

## 🔧 設定步驟

### 方法一：自動設定（推薦）
1. 開啟 `token-setup.html`
2. 點擊「⚡ 自動設定」按鈕
3. 系統會自動設定預設 Token

### 方法二：手動設定
1. 前往 [GitHub Settings > Personal Access Tokens](https://github.com/settings/tokens)
2. 點擊 "Generate new token (classic)"
3. 選擇 "repo" 權限
4. 複製生成的 Token
5. 在 `token-setup.html` 中貼上並設定

## 📱 使用方式

### 在 admin.html 中
- **自動檢查**: 頁面載入後自動開始檢查
- **手動檢查**: 點擊「檢查更新」按鈕
- **立即同步**: 點擊「儲存並同步」按鈕

### 在 index.html 中
- **背景檢查**: 每 5 分鐘自動檢查
- **頁面焦點**: 切換到頁面時自動檢查
- **更新通知**: 發現更新時顯示通知橫幅

## 🔔 更新通知

### 通知樣式
- **位置**: 頁面右上角
- **樣式**: 漸層背景，圓角設計
- **動畫**: 滑入動畫效果
- **自動消失**: 30 秒後自動關閉

### 通知內容
- 🆕 發現新版本提示
- 🔄 立即更新按鈕
- ⏰ 稍後提醒按鈕

## ⚙️ 技術細節

### 檢查機制
```javascript
// 檢查遠端 SHA 值
const remoteSha = file.sha;
const localSha = localStorage.getItem('data.json_sha');

// 比較是否有更新
const hasUpdate = remoteSha !== localSha;
```

### 更新流程
1. 檢查遠端 `data.json` 的 SHA 值
2. 與本地儲存的 SHA 值比較
3. 如有差異，顯示更新通知
4. 使用者點擊更新後，下載最新資料
5. 更新本地儲存並重新載入頁面

### 檢查觸發時機
- **定期檢查**: 每 5 分鐘
- **頁面可見**: 切換到頁面時
- **頁面焦點**: 視窗獲得焦點時
- **手動觸發**: 點擊檢查按鈕

## 🛠️ 自訂設定

### 修改檢查間隔
```javascript
// 設定為 10 分鐘檢查一次
updateChecker.setCheckInterval(10 * 60 * 1000);
```

### 修改 Token
在 `auto-setup-token.js` 中修改：
```javascript
this.defaultToken = '您的實際Token';
```

## 🔍 除錯工具

### 檢查 Token 狀態
```javascript
// 在瀏覽器控制台執行
window.tokenAutoSetup.showTokenStatus();
```

### 手動檢查更新
```javascript
// 在瀏覽器控制台執行
window.updateChecker.manualCheck();
```

### 清除快取
開啟 `clear-cache.html` 清除所有快取資料

## 📊 狀態監控

### Token 狀態
- ✅ 已設定：Token 存在且長度正確
- ❌ 未設定：Token 不存在或格式錯誤

### 更新狀態
- 🔍 檢查中：正在檢查遠端更新
- ✅ 已是最新：本地版本與遠端一致
- 🆕 發現更新：遠端有新版本可用

## 🚨 常見問題

### Q: Token 設定後仍無法同步？
A: 請確認 Token 權限包含 "repo" 選項

### Q: 更新通知沒有出現？
A: 檢查瀏覽器控制台是否有錯誤訊息

### Q: 自動檢查不工作？
A: 確認頁面沒有被最小化或隱藏

### Q: 如何停用自動檢查？
A: 在 `update-checker.js` 中註解掉 `startPeriodicCheck()` 呼叫

## 📝 更新日誌

### v1.0.0
- ✅ 自動 Token 設定
- ✅ 智能更新檢查
- ✅ 美觀的通知介面
- ✅ 多種觸發時機
- ✅ 完整的除錯工具

# 🔄 更新檢查功能說明

## 📋 功能概述

更新檢查功能會自動監控遠端 GitHub 倉庫的 `data.json` 檔案，當發現有新版本時會通知使用者，並提供一鍵更新功能。

## 🚀 自動設定

### 1. Token 自動設定
- **檔案**: `auto-setup-token.js`
- **功能**: 自動設定 GitHub Token，無需手動輸入
- **預設 Token**: 已內建預設 Token（請替換為您的實際 Token）

### 2. 更新檢查器
- **檔案**: `update-checker.js`
- **功能**: 智能更新檢查和通知
- **檢查間隔**: 每 5 分鐘自動檢查一次

## 🔧 設定步驟

### 方法一：自動設定（推薦）
1. 開啟 `token-setup.html`
2. 點擊「⚡ 自動設定」按鈕
3. 系統會自動設定預設 Token

### 方法二：手動設定
1. 前往 [GitHub Settings > Personal Access Tokens](https://github.com/settings/tokens)
2. 點擊 "Generate new token (classic)"
3. 選擇 "repo" 權限
4. 複製生成的 Token
5. 在 `token-setup.html` 中貼上並設定

## 📱 使用方式

### 在 admin.html 中
- **自動檢查**: 頁面載入後自動開始檢查
- **手動檢查**: 點擊「檢查更新」按鈕
- **立即同步**: 點擊「儲存並同步」按鈕

### 在 index.html 中
- **背景檢查**: 每 5 分鐘自動檢查
- **頁面焦點**: 切換到頁面時自動檢查
- **更新通知**: 發現更新時顯示通知橫幅

## 🔔 更新通知

### 通知樣式
- **位置**: 頁面右上角
- **樣式**: 漸層背景，圓角設計
- **動畫**: 滑入動畫效果
- **自動消失**: 30 秒後自動關閉

### 通知內容
- 🆕 發現新版本提示
- 🔄 立即更新按鈕
- ⏰ 稍後提醒按鈕

## ⚙️ 技術細節

### 檢查機制
```javascript
// 檢查遠端 SHA 值
const remoteSha = file.sha;
const localSha = localStorage.getItem('data.json_sha');

// 比較是否有更新
const hasUpdate = remoteSha !== localSha;
```

### 更新流程
1. 檢查遠端 `data.json` 的 SHA 值
2. 與本地儲存的 SHA 值比較
3. 如有差異，顯示更新通知
4. 使用者點擊更新後，下載最新資料
5. 更新本地儲存並重新載入頁面

### 檢查觸發時機
- **定期檢查**: 每 5 分鐘
- **頁面可見**: 切換到頁面時
- **頁面焦點**: 視窗獲得焦點時
- **手動觸發**: 點擊檢查按鈕

## 🛠️ 自訂設定

### 修改檢查間隔
```javascript
// 設定為 10 分鐘檢查一次
updateChecker.setCheckInterval(10 * 60 * 1000);
```

### 修改 Token
在 `auto-setup-token.js` 中修改：
```javascript
this.defaultToken = '您的實際Token';
```

## 🔍 除錯工具

### 檢查 Token 狀態
```javascript
// 在瀏覽器控制台執行
window.tokenAutoSetup.showTokenStatus();
```

### 手動檢查更新
```javascript
// 在瀏覽器控制台執行
window.updateChecker.manualCheck();
```

### 清除快取
開啟 `clear-cache.html` 清除所有快取資料

## 📊 狀態監控

### Token 狀態
- ✅ 已設定：Token 存在且長度正確
- ❌ 未設定：Token 不存在或格式錯誤

### 更新狀態
- 🔍 檢查中：正在檢查遠端更新
- ✅ 已是最新：本地版本與遠端一致
- 🆕 發現更新：遠端有新版本可用

## 🚨 常見問題

### Q: Token 設定後仍無法同步？
A: 請確認 Token 權限包含 "repo" 選項

### Q: 更新通知沒有出現？
A: 檢查瀏覽器控制台是否有錯誤訊息

### Q: 自動檢查不工作？
A: 確認頁面沒有被最小化或隱藏

### Q: 如何停用自動檢查？
A: 在 `update-checker.js` 中註解掉 `startPeriodicCheck()` 呼叫

## 📝 更新日誌

### v1.0.0
- ✅ 自動 Token 設定
- ✅ 智能更新檢查
- ✅ 美觀的通知介面
- ✅ 多種觸發時機
- ✅ 完整的除錯工具
